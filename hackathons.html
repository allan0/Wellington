<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Essential Mini App Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no">
    <title>AI Hackathon Day 1 - Wellington</title> <!-- Simplified Title -->

    <!-- Standard Meta -->
    <meta name="description" content="Day 1 Agenda and details for the Dubai CommerCity x Wellington Campus AI Hackathon. Includes AI Judge Simulation & Live Leaderboard. Earn Welly Points by completing tasks!">
    <meta name="keywords" content="Wellington Campus, Dubai CommerCity, hackathon, AI, Day 1, agenda, judge, leaderboard, Telegram Mini App, profile, points, tasks, welly points">
    <meta name="author" content="Wellington Campus & Dubai CommerCity">
    <meta property="og:title" content="Dubai CommerCity x Wellington AI Hackathon - Day 1">
    <meta property="og:description" content="Detailed Day 1 Agenda and Support Info, featuring an AI Judge Simulation, Live Leaderboard, and Task Tracker with Welly Points within the Telegram Mini App.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wellingtoncampus.co/hackathon.html"> <!-- Update -->
    <meta property="og:image" content="./wellingtoncampus.png"> <!-- Update Path -->
    <meta property="og:image:alt" content="Wellington Campus Logo">
    <link rel="icon" href="./favicon.ico" type="image/x-icon"> <!-- Update Path -->

    <!-- **Telegram Mini App Script - MUST be first script** -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">

    <style>
        /* --- Root Variables (Keep existing) --- */
        :root {
            --primary-color: #d4af37; /* Gold */
            --secondary-color: #003366; /* Dark Blue */
            --text-color: #212529;
            --bg-color: #cce5ff; /* Light Blueish */
            --accent-color: #ffffff; /* White */
            --card-bg-color: rgba(255, 255, 255, 0.9);
            --success-color: #28a745;
            --error-color: #dc3545;
            --shadow: 0 8px 24px rgba(0,0,0,0.1);
            --border-radius: 15px;
            --bottom-nav-bg: var(--accent-color);
            --bottom-nav-icon: #6c757d;
            --bottom-nav-active: var(--primary-color);
        }

        /* --- Base Styles (Keep existing) --- */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.1) 75%, rgba(255,255,255,0.1)),
                              linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.1) 75%, rgba(255,255,255,0.1));
            background-size: 20px 20px;
            font-size: 1.0rem;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            min-height: var(--tg-viewport-height, 100vh);
            box-sizing: border-box;
            overflow-x: hidden;
            padding-bottom: calc(150px + var(--tg-safe-area-inset-bottom, 0px));
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Logo (Keep existing) --- */
        #main-header { text-align: center; margin-bottom: 1rem; position: relative; padding-top: 1rem; flex-shrink: 0; }
        #header-logo { display: block; margin: 0 auto 0.5rem auto; max-width: 100px; width: 100px; height: auto; position: relative; top: 0; left: 0; z-index: 10; cursor: pointer; transition: width 0.4s ease-in-out, max-width 0.4s ease-in-out, top 0.4s ease-in-out, left 0.4s ease-in-out, padding 0.4s ease-in-out, border-radius 0.4s ease-in-out, background-color 0.4s ease-in-out, box-shadow 0.4s ease-in-out; }
        #header-logo.logo-scrolled { position: fixed; top: 8px; left: 12px; width: 45px; max-width: 45px; height: auto; z-index: 1045; margin: 0; background-color: rgba(255, 255, 255, 0.85); padding: 4px; border-radius: 50%; box-shadow: 0 3px 8px rgba(0, 51, 102, 0.3); }
        body.logo-state-scrolled .container { padding-top: 60px; }

        /* --- User Profile (Keep existing) --- */
        #user-profile { position: fixed; top: 8px; right: 12px; font-size: 0.85rem; color: var(--secondary-color); background-color: rgba(255, 255, 255, 0.85); padding: 5px 10px; border-radius: 20px; display: flex; align-items: center; z-index: 1045; box-shadow: 0 2px 5px rgba(0, 51, 102, 0.2); transition: top 0.4s ease-in-out; }
        #user-avatar { display: inline-block; width: 28px; height: 28px; border-radius: 50%; margin-right: 8px; vertical-align: middle; background-color: #e9ecef; text-align: center; line-height: 28px; font-size: 18px; overflow: hidden; }
        #user-avatar img { display: block; width: 100%; height: 100%; object-fit: cover; }
        #user-name-display { font-weight: 600; margin-right: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; }
        #welly-points { font-weight: bold; margin-left: 5px; }
        #user-profile .fa-star { margin-left: 5px; }
        .welly-points-gain {
            position: fixed;
            z-index: 1100;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
            padding: 3px 8px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transition: top 0.8s ease-out, opacity 0.8s ease-out, transform 0.8s ease-out;
            pointer-events: none;
            white-space: nowrap;
        }


        /* --- Mini App Specific Adjustments --- */
        .navbar-custom { display: none; }
        .bottom-nav { display: flex; position: fixed; bottom: 0; left: 0; right: 0; width: 100%; background-color: var(--bottom-nav-bg); box-shadow: 0 -2px 10px rgba(0,0,0,0.1); padding: 0.5rem 0 max(0.5rem, var(--tg-safe-area-inset-bottom, 0px)); z-index: 1040; flex-shrink: 0; }
        .floating-button { position: fixed; width: 55px; height: 55px; font-size: 1.6rem; z-index: 1050; background-color: var(--secondary-color); color: var(--accent-color); border: 2px solid var(--primary-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0, 51, 102, 0.4); cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; }
        .floating-button:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0, 51, 102, 0.6); }

        /* --- MODIFIED: Task Tracker Button Position --- */
        #task-tracker-btn {
            left: 15px; /* Changed from right */
            bottom: calc(75px + var(--tg-safe-area-inset-bottom, 0px));
        }
        #ai-judge-btn {
            right: 15px; /* Kept on right */
            bottom: calc(75px + var(--tg-safe-area-inset-bottom, 0px));
            background-color: var(--primary-color); color: var(--secondary-color); border-color: var(--secondary-color);
        }
        /* Keep hover effects */
        #task-tracker-btn:hover { background-color: #004a8d; }
        #ai-judge-btn:hover { background-color: #b8860b; color: var(--secondary-color); }

        /* --- Main Container --- */
        .container { flex-grow: 1; width: 100%; }

        /* --- Other Existing Styles (Keep as before, truncated for brevity) --- */
         h1, h2, h3, h4, h5 { font-family: 'Poppins', sans-serif; color: var(--secondary-color); margin-top: 1rem; }
         h1 { color: var(--secondary-color); font-size: 1.8rem; }
         h1 .fa-cogs { color: var(--primary-color); }
         .hackathon-subtitle { color: var(--secondary-color); font-size: 1.1rem; font-weight: 400; margin-bottom: 1.2rem; }
         .card { border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 1rem; border: none; background-color: var(--card-bg-color); overflow: hidden; }
         .card-header { background-color: var(--secondary-color); color: var(--accent-color); font-weight: 600; border-bottom: 3px solid var(--primary-color); padding: 0.8rem 1.2rem; display: flex; align-items: center; justify-content: space-between; transition: background-color 0.2s ease; }
         .card-header h2 { color: var(--accent-color); margin: 0; font-size: 1.1rem; }
         .card-header i { margin-right: 0.6rem; font-size: 1rem; }
         .card-header[data-bs-toggle="collapse"] { cursor: pointer; }
         .card-header[data-bs-toggle="collapse"]:hover { background-color: #004a8d; }
         .card-header .chevron-icon { font-size: 0.9rem; transition: transform 0.3s ease; margin-left: auto; padding-left: 1rem; }
         .card-header .chevron-down { display: inline-block; }
         .card-header .chevron-up { display: none; }
         .card-header.collapsed .chevron-down { display: inline-block; }
         .card-header.collapsed .chevron-up { display: none; }
         .card-header:not(.collapsed) .chevron-down { display: none; }
         .card-header:not(.collapsed) .chevron-up { display: inline-block; transform: rotate(180deg); }
         .card-title { color: var(--secondary-color); margin-bottom: 1rem; font-size: 1.1rem; }
         .card-body { padding: 1.2rem; }
         .card-body h3 { margin-top: 0.5rem; font-size: 1.2rem; }
         .list-unstyled li, .list-group-item { margin-bottom: 0.7rem; display: flex; align-items: flex-start; line-height: 1.5; font-size: 0.95rem; }
         .list-unstyled i.fas, .list-unstyled i.fab, .list-group-item i.fas { color: var(--primary-color); margin-right: 0.8rem; width: 18px; text-align: center; flex-shrink: 0; margin-top: 0.15em; }
         #preparation .fa-check-circle { color: var(--success-color); }
         #preparation .fa-check { color: var(--primary-color); }
         #prizes .fa-trophy { color: #ffd700; }
         #prizes .fa-medal { color: #c0c0c0; }
         #prizes .fa-award { color: #cd7f32; }
         #prizes .fa-gifts { color: #f06292; }
         .checklist { padding-left: 0; list-style: none; margin-top: 1rem; }
         .checklist-item { background-color: #e9ecef; padding: 0.8rem 1rem; border-radius: 8px; margin-bottom: 0.6rem; transition: background-color 0.3s ease, color 0.3s ease, border-left 0.3s ease; display: flex; align-items: center; line-height: 1.4; border-left: 4px solid var(--secondary-color); cursor: default; font-size: 0.9rem; }
         .modal .checklist-item { cursor: pointer; } /* Make only modal items clickable */
         .modal .checklist-item:hover { background-color: #dfe6ec; }
         .checklist-item i.fa-circle { color: var(--secondary-color); margin-right: 0.75rem; font-size: 1em; transition: transform 0.2s ease; }
         .checklist-item i.fa-check-circle { color: var(--success-color); display: none; margin-right: 0.75rem; font-size: 1em; transition: transform 0.2s ease; }
         .checklist-item.completed { background-color: #dff0d8; color: #3c763d; border-left: 4px solid var(--success-color); }
         .checklist-item.completed i.fa-circle { display: none; }
         .checklist-item.completed i.fa-check-circle { display: inline-block; transform: scale(1.1); }
         .progress { height: 18px; font-size: 0.75rem; border-radius: 50px; background-color: #e9ecef; }
         .progress-bar { background-color: var(--primary-color); font-weight: bold; color: var(--accent-color); display: flex; align-items: center; justify-content: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); transition: width 0.6s ease; }
         .agenda-list { list-style: none; padding-left: 0; }
         /* ... other styles truncated ... */
         #task-message-area .alert { margin-top: 1rem; padding: 0.7rem 1rem; font-size: 0.9rem; }
         #aiJudgeModal .modal-body { min-height: 300px; }
         #judgeLoader { text-align: center; padding: 2rem 0; display: none; }
         #judgeLoader p { margin-top: 0.8rem; color: var(--secondary-color); font-style: italic; font-size: 0.9rem;}
         #judgeResultsArea { display: none; }
         /* ... more styles truncated ... */
         .bottom-nav .btn { color: var(--bottom-nav-icon); background-color: transparent; border: none; padding: 0.5rem; font-size: 0.85rem; display: flex; flex-direction: column; align-items: center; transition: color 0.3s ease; text-decoration: none; }
         .bottom-nav i { font-size: 1.1rem; margin-bottom: 0.15rem; }
         /* --- Add active style for bottom nav --- */
         .bottom-nav .btn.active { color: var(--bottom-nav-active); font-weight: 600;}

         /* --- Style for Point value on task --- */
         .task-points {
            font-size: 0.75rem;
            font-weight: bold;
            color: var(--accent-color);
            background-color: var(--primary-color);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto; /* Pushes to the right */
            margin-right: 5px; /* Spacing from edge */
            white-space: nowrap;
         }
         .checklist-item.completed .task-points {
             background-color: var(--success-color);
             color: var(--accent-color);
         }

    </style>
</head>
<body>
    <!-- User Profile Display (Top Right) - No Changes -->
    <div id="user-profile">
        <span id="user-avatar">ðŸŽ“</span>
        <span id="user-name-display">Player</span>
        | <i class="fas fa-star"></i>
        <span id="welly-points">0</span>Â WP
    </div>

    <!-- Main Content Container - No Changes -->
    <div class="container mt-2" id="hackathon">

        <!-- Header Section - No Changes -->
        <header id="main-header">
            <img src="./wellingtoncampus.png" alt="Wellington Campus Logo" id="header-logo">
            <h1><i class="fas fa-cogs me-2"></i>AI Hackathon</h1>
            <p class="hackathon-subtitle">Day 1 @ Dubai CommerCity</p>
        </header>

        <!-- Progress Bar Section -->
        <section id="progress" class="mb-3 card">
             <div class="card-header"> <h2><i class="fas fa-tasks"></i>Progress & Points</h2> </div> <!-- Title updated -->
             <div class="card-body">
                 <p class="small mb-2">Track Day 1 tasks via <i class="fas fa-tasks"></i> button & earn WP!</p> <!-- Text updated -->
                 <div class="progress" role="progressbar" aria-label="Hackathon Progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                     <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%">0%</div>
                 </div>
             </div>
        </section>

        <!-- Quick Info Section - No Changes -->
        <section id="quick-info" class="card mb-3">
             <div class="card-body">
                 <h3><i class="fas fa-bolt me-2"></i>Quick Info - Day 1</h3>
                 <ul class="list-unstyled">
                     <li><i class="fas fa-calendar-alt"></i> <strong>Event:</strong> Shaping Tomorrowâ€™s Solution</li>
                     <li><i class="fas fa-calendar-day"></i> <strong>Date:</strong> Mon, Apr 21, 2025</li>
                     <li><i class="fas fa-clock"></i> <strong>Time:</strong> 08:30 - 14:00</li>
                     <li><i class="fas fa-map-marker-alt"></i> <strong>Venue:</strong> Dubai CommerCity</li>
                 </ul>
             </div>
        </section>

        <!-- Collapsible Sections (Keep existing structure, content truncated for brevity) -->
        <div id="accordionHackathon">
            <!-- Agenda -->
            <section id="agenda" class="card mb-3">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#collapseAgenda" aria-expanded="true" aria-controls="collapseAgenda"> <h2><i class="fas fa-calendar-alt"></i>Agenda</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div>
                <div class="collapse show" id="collapseAgenda" data-bs-parent="#accordionHackathon">
                    <div class="card-body">
                        <!-- Agenda content remains the same -->
                         <h3 class="mb-3 mt-0 small" style="color: var(--primary-color);"><i class="fas fa-flag-checkered me-2"></i>Monday, 21st April 2025</h3>
                         <ul class="agenda-list"> <li> <span class="agenda-time"><i class="fas fa-sign-in-alt"></i>08:30</span> <span class="agenda-details"><strong>Registrations & Check-in</strong><p>Arrival, kits, refreshments.</p></span> <span class="agenda-speaker"><small>DAFZ & Wellington</small></span> </li> <li> <span class="agenda-time"><i class="fas fa-bullhorn"></i>09:00</span> <span class="agenda-details"><strong>Opening Speech</strong><p>Kick-off.</p></span> <span class="agenda-speaker"><small>Wellington</small></span> </li> <li> <span class="agenda-time"><i class="fas fa-scroll"></i>09:05</span> <span class="agenda-details"><strong>Code of Conduct</strong><p>Rules & IP.</p></span> <span class="agenda-speaker"><small>Coordinator</small></span> </li> <li> <span class="agenda-time"><i class="fas fa-users"></i>09:10</span> <span class="agenda-details"><strong>Team Intros</strong><p>Ice-breaker.</p></span> <span class="agenda-speaker"><small>All Teams</small></span> </li> <li> <span class="agenda-time"><i class="fas fa-dice"></i>09:20</span> <span class="agenda-details"><strong>Challenge Assignment</strong><p>Spin Wheel. <a href="game.html" target="_self" class="link-secondary small">(Go to Wheel)</a></p></span> <span class="agenda-speaker"><small>Facilitated</small></span> </li> <li> <span class="agenda-time"><i class="fas fa-laptop-code"></i>09:30</span> <span class="agenda-details"><strong>Hacking Begins!</strong></span> <span class="agenda-speaker">-</span> </li> <li class="agenda-break"> <span class="agenda-time"><i class="fas fa-headset"></i>Ongoing</span> <span class="agenda-details"><strong>Support Active</strong><p>Mentors, Help Desk, Pitch Coach.</p></span> <span class="agenda-speaker"><small>Wellington</small></span> </li> <li class="agenda-break"> <span class="agenda-time"><i class="fas fa-utensils"></i>~12:30</span> <span class="agenda-details"><strong>Lunch Break</strong></span> <span class="agenda-speaker">-</span> </li> <li> <span class="agenda-time"><i class="fas fa-flag-checkered"></i>14:00</span> <span class="agenda-details"><strong>Day 1 Wrap-Up & Submit</strong><p>Submit rough model & deck draft.</p></span> <span class="agenda-speaker"><small>Via Link</small></span> </li> </ul>
                    </div>
                </div>
            </section>
            <!-- Other sections (Support, Outcomes, etc.) - Keep as before -->
            <section id="support" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseSupport" aria-expanded="false" aria-controls="collapseSupport"> <h2><i class="fas fa-hands-helping"></i>Support</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseSupport" data-bs-parent="#accordionHackathon"> <div class="card-body"> <ul class="list-unstyled"> <li><i class="fas fa-chalkboard-teacher"></i> Briefing & Q&A</li> <li><i class="fas fa-user-friends"></i> Mentor Assignment</li> <li><i class="fas fa-headset"></i> Help Desk</li> <li><i class="fas fa-microphone-alt"></i> Pitch Coaching</li> <li><i class="fas fa-folder-open"></i> Resource Access</li> </ul> </div> </div> </section>
            <section id="outcomes" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseOutcomes" aria-expanded="false" aria-controls="collapseOutcomes"> <h2><i class="fas fa-check-double"></i>Outcomes</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseOutcomes" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">By end of Day 1:</p> <ul class="list-unstyled"> <li><i class="fas fa-cogs text-success"></i> Rough model/logic</li> <li><i class="fas fa-file-powerpoint text-success"></i> Draft pitch deck</li> <li><i class="fas fa-upload text-success"></i> Submitted materials</li> </ul> </div> </div> </section>
            <section id="tracks" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseTracks" aria-expanded="false" aria-controls="collapseTracks"> <h2><i class="fas fa-stream"></i>Themes</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseTracks" data-bs-parent="#accordionHackathon"> <div class="card-body"> <ul class="list-unstyled"> <li><i class="fas fa-truck-loading"></i> Supply Chain</li> <li><i class="fas fa-leaf"></i> Sustainability</li> <li><i class="fas fa-briefcase-medical"></i> Healthcare</li> <li><i class="fas fa-tasks"></i> Project Mgmt</li> <li><i class="fas fa-city"></i> Real Estate</li> <li><i class="fas fa-landmark"></i> Government</li> <li><i class="fas fa-lightbulb"></i> Open Innovation</li> </ul> <p class="small text-muted mt-2">Assigned via <a href="game.html" target="_self">Spin the Wheel</a>.</p> </div> </div> </section>
            <section id="preparation" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapsePrep" aria-expanded="false" aria-controls="collapsePrep"> <h2><i class="fas fa-laptop-code"></i>Preparation</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapsePrep" data-bs-parent="#accordionHackathon"> <div class="card-body"> <h5 class="card-title small"><i class="fas fa-laptop me-2"></i>Hardware</h5> <ul class="list-unstyled ps-2 small"> <li><i class="fas fa-check-circle"></i> Laptop</li> <li><i class="fas fa-check-circle"></i> Charger</li> <li><i class="fas fa-check-circle"></i> Wi-Fi @ Venue</li> </ul> <h5 class="card-title small mt-2"><i class="fas fa-tools me-2"></i>Software</h5> <ul class="list-unstyled ps-2 small"> <li><i class="fab fa-python"></i> Python 3.8+</li> <li><i class="fas fa-book"></i> Jupyter/Editor</li> <li><i class="fas fa-code-branch"></i> Git/GitHub</li> <li><i class="fas fa-brain"></i> AI Libs (Opt)</li> <li><i class="fas fa-cloud-upload-alt"></i> Cloud Acct (Opt)</li> </ul> <h5 class="card-title small mt-2"><i class="fas fa-lightbulb me-2"></i>Knowledge</h5> <ul class="list-unstyled ps-2 small"> <li><i class="fas fa-check"></i> Python Basics</li> <li><i class="fas fa-check"></i> Basic AI/ML</li> <li><i class="fas fa-check"></i> Teamwork!</li> </ul> </div> </div> </section>
            <section id="prizes" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapsePrizes" aria-expanded="false" aria-controls="collapsePrizes"> <h2><i class="fas fa-trophy"></i>Prizes</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapsePrizes" data-bs-parent="#accordionHackathon"> <div class="card-body"> <ul class="list-unstyled small"> <li><i class="fas fa-trophy"></i> 1st: AED 10k, Swag, Ops</li> <li><i class="fas fa-medal"></i> 2nd: AED 5k, Swag</li> <li><i class="fas fa-award"></i> 3rd: AED 2.5k, Swag</li> <li><i class="fas fa-lightbulb"></i> Innovation Award</li> <li><i class="fas fa-gifts"></i> All: Certificate, Swag</li> <li><i class="fas fa-handshake"></i> Networking</li> </ul> </div> </div> </section>
            <section id="judging" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseJudging" aria-expanded="false" aria-controls="collapseJudging"> <h2><i class="fas fa-gavel"></i>Judging</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseJudging" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">Final judging (Day 2) considers:</p> <ul class="list-unstyled small"> <li><i class="fas fa-cogs"></i> Technical</li> <li><i class="fas fa-lightbulb"></i> Innovation</li> <li><i class="fas fa-bullseye"></i> Impact</li> <li><i class="fas fa-presentation"></i> Pitch/Demo</li> <li><i class="fas fa-check-circle"></i> Completion</li> </ul> </div> </div> </section>
            <section id="logistics-info" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseLogistics" aria-expanded="false" aria-controls="collapseLogistics"> <h2><i class="fas fa-building me-2"></i>Logistics</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseLogistics" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">Venue requests:</p> <ul class="list-unstyled small"> <li><i class="fas fa-users"></i> Breakout spaces</li> <li><i class="fas fa-desktop"></i> Screen/Projector</li> <li><i class="fas fa-video"></i> Basic Recording?</li> </ul> </div> </div> </section>
            <section id="registration-note" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseRegNote" aria-expanded="false" aria-controls="collapseRegNote"> <h2><i class="fas fa-user-check"></i>Registration</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseRegNote" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">Managed via prior official communication. Ensure team details are confirmed.</p> </div> </div> </section>
            <section id="contact" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseContact" aria-expanded="false" aria-controls="collapseContact"> <h2><i class="fas fa-envelope"></i>Contact</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseContact" data-bs-parent="#accordionHackathon"> <div class="card-body"> <div class="row small"> <div class="col-6 mb-2"> <strong>Wellington:</strong> <ul class="list-unstyled mt-1"> <li><i class="fas fa-envelope-open-text"></i> <a href="mailto:info@wellingtoncampus.co">Email</a></li> <li><i class="fas fa-phone"></i> <a href="tel:+971542523922">Call</a></li> </ul> </div> <div class="col-6 mb-2"> <strong>CommerCity:</strong> <ul class="list-unstyled mt-1"> <li><i class="fas fa-envelope-open-text"></i> Email DCC</li> <li><i class="fas fa-phone"></i> Call DCC</li> </ul> </div> </div> </div> </div> </section>
        </div> <!-- End Accordion -->

        <!-- Footer - No Changes -->
        <footer class="text-center mt-3 mb-3 text-muted">
            <small>Â© 2024-25 DCC & Wellington Campus</small>
        </footer>

    </div> <!-- End Main Container -->

    <!-- Floating Buttons (Position updated via CSS) -->
    <button class="floating-button" id="task-tracker-btn" title="Task Tracker" data-bs-toggle="modal" data-bs-target="#taskTrackerModal">
        <i class="fas fa-tasks"></i>
    </button>
    <button class="floating-button" id="ai-judge-btn" title="AI Judge Sim" data-bs-toggle="modal" data-bs-target="#aiJudgeModal">
        <i class="fas fa-gavel"></i>
    </button>

    <!-- Task Tracker Modal -->
    <div class="modal fade" id="taskTrackerModal" tabindex="-1" aria-labelledby="taskTrackerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskTrackerModalLabel"><i class="fas fa-tasks me-2"></i>Day 1 Tasks & Points</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">Tap task to verify & mark complete. Earn Welly Points!</p>
                    <div id="task-message-area" class="mb-3"></div>
                    <div class="checklist" id="modal-checklist">
                        <!-- ADDED data-points attribute and points span -->
                        <div class="checklist-item" data-task-id="register" data-points="5">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Check-in</strong></div>
                            <span class="task-points">+5 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="briefing" data-points="5">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Attend Briefing</strong></div>
                            <span class="task-points">+5 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="challenge" data-points="10">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Get Challenge</strong></div>
                            <span class="task-points">+10 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="brainstorm" data-points="15">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Plan Approach</strong></div>
                            <span class="task-points">+15 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="mentor-meet" data-points="10">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Meet Mentor</strong></div>
                            <span class="task-points">+10 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="logic-dev" data-points="25">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Develop Logic/Model (Draft)</strong></div>
                            <span class="task-points">+25 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="deck-start" data-points="15">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Start Pitch Deck (Draft)</strong></div>
                            <span class="task-points">+15 WP</span>
                        </div>
                        <div class="checklist-item" data-task-id="pitch-coach" data-points="10">
                             <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                             <div><strong>Pitch Coach Session (Optional)</strong></div>
                             <span class="task-points">+10 WP</span>
                         </div>
                        <div class="checklist-item" data-task-id="day1-submit" data-points="20">
                            <i class="far fa-circle"></i><i class="far fa-check-circle"></i>
                            <div><strong>Submit Day 1 Drafts</strong></div>
                            <span class="task-points">+20 WP</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Judge Modal - No Changes needed here -->
    <div class="modal fade" id="aiJudgeModal" tabindex="-1" aria-labelledby="aiJudgeModalLabel" aria-hidden="true">
         <div class="modal-dialog modal-lg modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="aiJudgeModalLabel"><i class="fas fa-brain me-2"></i>AI Judge Sim</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <p class="text-muted small">Select team, click Judge.</p> <div class="row g-2 align-items-end mb-3"> <div class="col-8"> <label for="judgeTeamSelect" class="form-label visually-hidden">Select Team:</label> <select class="form-select form-select-sm" id="judgeTeamSelect"> <option selected disabled value="">-- Choose Team --</option> <option value="Team Alpha">Team Alpha (Logistics)</option> <option value="Team Beta">Team Beta (Sustainability)</option> <option value="Team Gamma">Team Gamma (Healthcare)</option> <option value="Team Delta">Team Delta (Open Innovation)</option> <option value="The AI Mavericks">The AI Mavericks (Proj Mgmt)</option> </select> </div> <div class="col-4"> <button class="btn btn-primary w-100 btn-sm" type="button" id="judgeProjectBtn"> <i class="fas fa-play me-1"></i> Judge </button> </div> </div> <div id="judgeLoader"> <div class="spinner-border spinner-border-sm text-primary" role="status"> <span class="visually-hidden">Loading...</span> </div> <p class="small">AI analyzing...</p> </div> <div id="judgeResultsArea"> <h5 id="judgeResultTeamName" class="small"></h5> <div id="judgeResultAnalysis"> <h6 class="small">Analysis:</h6> <ul id="judgeResultAnalysisList" class="small"></ul> </div> <div id="judgeResultScore"></div> </div> <p class="mb-0 small text-muted fst-italic mt-3"> <i class="fas fa-info-circle me-1"></i> Simulation only. </p> <hr class="my-3"> <div id="leaderboardSection"> <h5 class="text-center mb-2 small"><i class="fas fa-trophy me-2" style="color: var(--primary-color);"></i>Leaderboard</h5> <div class="table-responsive"> <table class="table table-striped table-hover table-sm align-middle small"> <thead class="table-dark small"> <tr> <th scope="col" style="width: 15%; text-align: center;">Rank</th> <th scope="col">Team</th> <th scope="col" style="width: 25%; text-align: center;">Score</th> </tr> </thead> <tbody id="leaderboard-body"> <tr id="leaderboard-placeholder"> <td colspan="3" class="text-center text-muted fst-italic py-2 small">Judge teams to populate...</td> </tr> </tbody> </table> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button> </div> </div> </div>
    </div>

    <!-- Flying Score Element - No Changes -->
    <div id="flying-score-element"></div>

    <!-- Bottom Navigation - Added active class to Hackathon -->
    <nav class="bottom-nav" aria-label="Mobile navigation">
         <div class="d-flex justify-content-around w-100">
             <a href="index.html" target="_self" class="btn"><i class="fas fa-home"></i>Home</a>
             <a href="courses.html" target="_self" class="btn"><i class="fas fa-book"></i>LMS</a>
             <a href="game.html" target="_self" class="btn"><i class="fas fa-puzzle-piece"></i>Quest</a>
             <a href="hackathon.html" target="_self" class="btn active"><i class="fas fa-laptop-code"></i>Hackathon</a> <!-- Added 'active' class -->
         </div>
     </nav>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Mini App & Feature Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tg = window.Telegram.WebApp;

            // --- Element References ---
            const logo = document.getElementById('header-logo');
            const bodyElement = document.body;
            const userNameDisplay = document.getElementById('user-name-display');
            const wellyPointsDisplay = document.getElementById('welly-points');
            const userAvatarContainer = document.getElementById('user-avatar');
            const userProfileElement = document.getElementById('user-profile'); // Ref for points animation target
            const modalChecklist = document.getElementById('modal-checklist');
            const messageArea = document.getElementById('task-message-area');
            const progressBar = document.querySelector('#progress .progress-bar');
            const taskModalElement = document.getElementById('taskTrackerModal');
            const judgeModalElement = document.getElementById('aiJudgeModal');
            const judgeTeamSelect = document.getElementById('judgeTeamSelect');
            const judgeProjectBtn = document.getElementById('judgeProjectBtn');
            const judgeLoader = document.getElementById('judgeLoader');
            const judgeResultsArea = document.getElementById('judgeResultsArea');
            const judgeResultTeamName = document.getElementById('judgeResultTeamName');
            const judgeResultAnalysisList = document.getElementById('judgeResultAnalysisList');
            const judgeResultScore = document.getElementById('judgeResultScore');
            const leaderboardSection = document.getElementById('leaderboardSection');
            const leaderboardBody = document.getElementById('leaderboard-body');
            const flyingScoreElement = document.getElementById('flying-score-element');
            const leaderboardPlaceholder = document.getElementById('leaderboard-placeholder');


            // --- State Variables ---
            let currentUser = null;
            let totalWellyPoints = 0;
            let taskState = {}; // Load after initializing TG
            let leaderboardData = []; // AI Judge Leaderboard data

            // --- Initialize Telegram Mini App & Profile ---
            function initializeTelegramApp() {
                if (tg && tg.initDataUnsafe) {
                    tg.ready();
                    tg.expand(); // Expand the Mini App view
                    tg.BackButton.show();
                    tg.onEvent('backButtonClicked', handleBackButton);

                    currentUser = tg.initDataUnsafe.user;
                    updateUserProfileDisplay();
                    loadWellyPoints(); // Load points AFTER initializing TG

                    // Load task state AFTER TG is ready and points are loaded
                    loadTaskState().then(() => {
                        initializeTaskUI(); // Populate UI based on loaded state
                        updateProgressBar(); // Update progress bar after loading state
                    });

                    console.log("Telegram Mini App Initialized on Hackathon Page.");
                    if (tg.CloudStorage) {
                        console.log("CloudStorage is available.");
                    } else {
                         console.warn("CloudStorage is NOT available.");
                    }

                } else {
                    console.warn("Not running in Telegram context or initDataUnsafe missing.");
                    const profileElement = document.getElementById('user-profile');
                    if(profileElement) profileElement.style.display = 'none'; // Hide profile if not in TG
                    // Initialize tasks with local storage if not in TG
                    taskState = loadTaskStateLocal();
                    initializeTaskUI();
                    updateProgressBar();
                }
            }

            function handleBackButton() {
                // Navigate back or close the app
                if (window.history.length > 1) {
                    window.history.back();
                } else if (tg && tg.close) {
                    tg.close();
                } else {
                    console.log("No history to go back to.");
                    // Potentially redirect to a known 'home' page if needed
                    // window.location.href = 'index.html';
                }
            }

             function updateUserProfileDisplay() {
                 if (!currentUser) {
                     if(userNameDisplay) userNameDisplay.textContent = 'Guest';
                     if(userAvatarContainer) userAvatarContainer.textContent = 'ðŸ‘¤';
                     return;
                 };
                 if (userNameDisplay) userNameDisplay.textContent = currentUser.first_name || 'Player';
                 if (userAvatarContainer) {
                     userAvatarContainer.innerHTML = ''; // Clear default
                     if (currentUser.photo_url) {
                         const img = document.createElement('img');
                         img.src = currentUser.photo_url;
                         img.alt = `${currentUser.first_name}'s photo`; // More descriptive alt text
                         userAvatarContainer.appendChild(img);
                     } else {
                         userAvatarContainer.textContent = 'ðŸŽ“'; // Fallback icon
                     }
                 }
             }

             // --- Welly Points Management ---
             function loadWellyPoints() {
                 return new Promise((resolve) => {
                     totalWellyPoints = 0; // Default
                     if (tg && tg.CloudStorage) {
                          console.log("Attempting to load WP from CloudStorage...");
                          tg.CloudStorage.getItem('totalWellyPoints', (error, value) => {
                               if (error) {
                                   console.error("CS Load Error:", error);
                                   tg.showAlert(`Error loading points: ${error}`);
                                   totalWellyPoints = 0; // Fallback
                               } else if (value) {
                                   totalWellyPoints = parseInt(value, 10) || 0;
                                   console.log("Loaded WP from CloudStorage:", totalWellyPoints);
                               } else {
                                   totalWellyPoints = 0;
                                   console.log("No WP found in CloudStorage, starting at 0.");
                               }
                               updateWellyPointsDisplay(); // Update UI after loading
                               resolve(); // Resolve the promise
                          });
                     } else {
                         console.warn("CloudStorage not available. Points will not persist.");
                         updateWellyPointsDisplay(); // Update UI with default 0
                         resolve(); // Resolve anyway
                     }
                 });
             }

            function saveWellyPoints() {
                 if (tg && tg.CloudStorage) {
                     console.log("Attempting to save WP to CloudStorage:", totalWellyPoints);
                     tg.CloudStorage.setItem('totalWellyPoints', totalWellyPoints.toString(), (error, success) => {
                          if (error) {
                              console.error("CS Save Error:", error);
                              tg.showAlert(`Error saving points: ${error}`);
                          } else if (success) {
                              console.log("WP saved successfully to CloudStorage:", totalWellyPoints);
                          } else {
                               console.warn("WP save call completed, but success flag was not true.");
                          }
                     });
                 } else {
                      console.warn("CloudStorage not available. Points not saved.");
                 }
             }

             function updateWellyPointsDisplay() {
                 if (wellyPointsDisplay) {
                     wellyPointsDisplay.textContent = totalWellyPoints;
                 }
             }

            function showPointsGainAnimation(points) {
                 if (!userProfileElement || points <= 0) return;

                 const gainElement = document.createElement('div');
                 gainElement.textContent = `+${points} WP`;
                 gainElement.className = 'welly-points-gain';
                 document.body.appendChild(gainElement);

                 const profileRect = userProfileElement.getBoundingClientRect();
                 const startX = profileRect.left + profileRect.width / 2;
                 const startY = profileRect.bottom + 10; // Start below the profile

                 gainElement.style.left = `${startX}px`;
                 gainElement.style.top = `${startY}px`;
                 gainElement.style.transform = 'translateX(-50%) scale(0.8)'; // Center align horizontally

                 // Force reflow to apply initial styles before transition
                 void gainElement.offsetWidth;

                 // Animate upwards and fade out
                 gainElement.style.top = `${startY - 40}px`;
                 gainElement.style.opacity = '1';
                 gainElement.style.transform = 'translateX(-50%) scale(1)';

                 setTimeout(() => {
                     gainElement.style.opacity = '0';
                     gainElement.style.transform = 'translateX(-50%) scale(0.8)';
                     setTimeout(() => {
                         gainElement.remove();
                     }, 800); // Remove after fade out transition
                 }, 1000); // Start fading out after 1 second
             }

            // --- Shrinking Logo Logic ---
            function setupLogoScroll() {
                 if (logo) {
                     const handleScroll = () => {
                         const isScrolled = window.scrollY > 30;
                         logo.classList.toggle('logo-scrolled', isScrolled);
                         bodyElement.classList.toggle('logo-state-scrolled', isScrolled);
                     };
                     logo.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); });
                     window.addEventListener('scroll', handleScroll, { passive: true });
                     handleScroll(); // Initial check
                 }
            }

            // --- Task Tracker Logic (Modified for Points & Verification) ---

            const TASK_STATE_KEY_CS = 'hackathonDay1TaskStatus_CS'; // CloudStorage key
            const TASK_STATE_KEY_LS = 'hackathonDay1TaskStatus_LS'; // LocalStorage fallback key

            // Load state: Prioritize CloudStorage, fallback to LocalStorage
            function loadTaskState() {
                return new Promise((resolve) => {
                    if (tg && tg.CloudStorage) {
                        tg.CloudStorage.getItem(TASK_STATE_KEY_CS, (error, value) => {
                            if (error) {
                                console.error("CS Task Load Error:", error);
                                // Fallback to localStorage on CS error
                                taskState = loadTaskStateLocal();
                                resolve();
                            } else if (value) {
                                try {
                                    taskState = JSON.parse(value);
                                    console.log("Loaded Task State from CloudStorage:", taskState);
                                } catch (e) {
                                    console.error("Error parsing Task State from CS:", e);
                                    taskState = loadTaskStateLocal(); // Fallback if parse error
                                }
                                resolve();
                            } else {
                                console.log("No Task State in CloudStorage, trying LocalStorage.");
                                taskState = loadTaskStateLocal(); // Fallback if no value in CS
                                resolve();
                            }
                        });
                    } else {
                        console.warn("CloudStorage not available for tasks. Using LocalStorage.");
                        taskState = loadTaskStateLocal();
                        resolve();
                    }
                });
            }

            // Helper to load from LocalStorage
            function loadTaskStateLocal() {
                const storedState = localStorage.getItem(TASK_STATE_KEY_LS);
                try {
                     return storedState ? JSON.parse(storedState) : {};
                } catch (e) {
                    console.error("Error parsing Task State from LocalStorage:", e);
                    return {}; // Return empty if parse error
                }
            }

            // Save state: Save to both CloudStorage (if available) and LocalStorage
            function saveTaskState(state) {
                 const stateString = JSON.stringify(state);

                 // Save to CloudStorage
                 if (tg && tg.CloudStorage) {
                     tg.CloudStorage.setItem(TASK_STATE_KEY_CS, stateString, (error, success) => {
                          if (error) {
                              console.error("CS Task Save Error:", error);
                              // Optionally show user error
                          } else if (success) {
                              console.log("Task State saved successfully to CloudStorage.");
                          } else {
                              console.warn("Task State CS save call completed, but success flag was not true.");
                          }
                     });
                 }

                 // Save to LocalStorage (always, as backup or primary if CS fails/unavailable)
                 try {
                    localStorage.setItem(TASK_STATE_KEY_LS, stateString);
                    console.log("Task State saved to LocalStorage.");
                 } catch (e) {
                     console.error("Error saving Task State to LocalStorage:", e);
                 }
            }


            function initializeTaskUI() {
                if (!modalChecklist) return;
                modalChecklist.querySelectorAll('.checklist-item[data-task-id]').forEach(item => {
                    const taskId = item.dataset.taskId;
                    updateTaskUI(taskId, taskState[taskId] === true); // Update based on loaded state
                });
            }

            function updateTaskUI(taskId, isCompleted) {
                const modalItem = modalChecklist?.querySelector(`.checklist-item[data-task-id="${taskId}"]`);
                if (modalItem) {
                    modalItem.classList.toggle('completed', isCompleted);
                }
            }

            function showMessage(message, type = 'success') {
                if (messageArea) {
                    // Simple message display
                    messageArea.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show small p-2" role="alert">${message}<button type="button" class="btn-close btn-sm p-2" data-bs-dismiss="alert" aria-label="Close"></button></div>`;

                    // Optional: Use Telegram's native popup for important messages
                    // if (tg && tg.showAlert) {
                    //     tg.showAlert(message);
                    // }
                }
            }

            function clearMessages() {
                if (messageArea) { messageArea.innerHTML = ''; }
            }

            function updateProgressBar() {
                const taskItems = modalChecklist?.querySelectorAll('.checklist-item[data-task-id]');
                if (!taskItems || taskItems.length === 0 || !progressBar) return;

                const totalTasks = taskItems.length;
                // Count completed tasks directly from the current state object
                const completedTasks = Object.values(taskState).filter(status => status === true).length;

                const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

                progressBar.style.width = progressPercent + '%';
                progressBar.textContent = `${progressPercent}%`;
                progressBar.setAttribute('aria-valuenow', progressPercent);
                progressBar.classList.toggle('bg-success', progressPercent === 100);
                progressBar.classList.toggle('progress-bar-animated', progressPercent < 100);
                progressBar.classList.toggle('progress-bar-striped', progressPercent < 100);
            }

            // Attach Event Listener for Task Clicks
            if (modalChecklist) {
                modalChecklist.addEventListener('click', function(event) {
                    const taskItem = event.target.closest('.checklist-item[data-task-id]');
                    if (!taskItem) return; // Ignore clicks not on a task item

                    const taskId = taskItem.dataset.taskId;
                    const taskNameElement = taskItem.querySelector('strong');
                    const taskName = taskNameElement ? taskNameElement.textContent.trim() : `Task ${taskId}`;
                    const pointsToAdd = parseInt(taskItem.dataset.points || '0', 10);
                    const isCurrentlyCompleted = taskState[taskId] === true;

                    clearMessages(); // Clear previous messages

                    if (isCurrentlyCompleted) {
                        // --- Action: Mark as Incomplete ---
                        const confirmationMessage = `Mark "${taskName}" as incomplete? (Points will not be deducted)`;
                        if (confirm(confirmationMessage)) {
                            taskState[taskId] = false; // Update state object
                            saveTaskState(taskState);  // Save the updated state
                            updateTaskUI(taskId, false); // Update item UI
                            updateProgressBar();      // Update progress bar
                            showMessage(`Task "${taskName}" marked incomplete.`, 'warning');
                        } else {
                            // User cancelled
                        }
                    } else {
                        // --- Action: Mark as Complete ---
                        const confirmationMessage = `Mark "${taskName}" as complete and claim ${pointsToAdd} WP?`;
                        if (confirm(confirmationMessage)) {
                            taskState[taskId] = true; // Update state object
                            saveTaskState(taskState); // Save the updated state
                            updateTaskUI(taskId, true);  // Update item UI

                            // Award points ONLY if points > 0
                            if (pointsToAdd > 0) {
                                totalWellyPoints += pointsToAdd;
                                saveWellyPoints();       // Save the new points total
                                updateWellyPointsDisplay(); // Update points display in header
                                showPointsGainAnimation(pointsToAdd); // Show visual feedback
                                showMessage(`Task "${taskName}" complete! +${pointsToAdd} WP earned.`, 'success');
                            } else {
                                showMessage(`Task "${taskName}" complete!`, 'success'); // Message without points if 0
                            }

                            updateProgressBar();      // Update progress bar
                        } else {
                             // User cancelled
                        }
                    }
                });
            } else {
                console.warn("Modal checklist container (#modal-checklist) not found.");
            }


            if (taskModalElement) {
                taskModalElement.addEventListener('hidden.bs.modal', clearMessages);
            }
            // Initial updateProgressBar call is now inside initializeTelegramApp after loading state


            // --- AI Judge & Leaderboard Logic (Keep existing - unchanged) ---
            const teamAnalysisData = { "Team Alpha": ["Strong logistics model.", "Good data processing.", "Innovation moderate.", "High feasibility.", "Presentation needs polish."], "Team Beta": ["Creative environment monitoring.", "Well-organized code.", "High innovation potential.", "Needs validation.", "Compelling impact analysis."], "Team Gamma": ["Sound NLP for feedback.", "Relevant healthcare problem.", "Demo lacks user-friendliness.", "Significant potential impact.", "Solid innovation."], "Team Delta": ["Very high novelty factor.", "Promising tech execution.", "Optimistic feasibility.", "Pitch conveys vision.", "Adequate completion."], "The AI Mavericks": ["Well-implemented risk prediction.", "Good data integration.", "Practical solution.", "Good technical depth.", "Clear presentation & demo."] };
            function displayAnalysisSequentially(analysisPoints) { if (!judgeResultAnalysisList) return 0; judgeResultAnalysisList.innerHTML = ''; let delay = 0; const interval = 400; analysisPoints.forEach(point => { setTimeout(() => { const li = document.createElement('li'); li.textContent = point; judgeResultAnalysisList.appendChild(li); void li.offsetWidth; li.classList.add('visible'); }, delay); delay += interval; }); return delay; }
            function generateScore(teamName) { let baseScore = 6.0; let randomness = Math.random() * 2.0; let bonus = 0; if (teamName === "Team Beta" || teamName === "The AI Mavericks") bonus = 0.5 + Math.random(); if (teamName === "Team Delta") bonus = Math.random() * 1.5; let finalScore = baseScore + randomness + bonus; finalScore = Math.min(Math.max(finalScore, 4.0), 9.8); return parseFloat(finalScore.toFixed(1)); }
            function updateLeaderboardData(teamName, score) { const existingIndex = leaderboardData.findIndex(item => item.teamName === teamName); if (existingIndex > -1) { leaderboardData[existingIndex].score = score; } else { leaderboardData.push({ teamName: teamName, score: score }); } leaderboardData.sort((a, b) => b.score - a.score); }
            function animateTextWordByWord(element, text, speed = 50) { element.innerHTML = ''; const words = text.split(' '); let currentWordIndex = 0; let intervalId = setInterval(() => { if (currentWordIndex < words.length) { const span = document.createElement('span'); span.textContent = words[currentWordIndex] + ' '; element.appendChild(span); setTimeout(() => span.classList.add('visible'), 10); currentWordIndex++; } else { clearInterval(intervalId); } }, speed); }
            function renderLeaderboard(highlightTeam = null) { if (!leaderboardBody) return; leaderboardBody.innerHTML = ''; if (leaderboardData.length === 0) { leaderboardBody.innerHTML = `<tr id="leaderboard-placeholder"><td colspan="3" class="text-center text-muted fst-italic py-2 small">Judge teams to populate...</td></tr>`; leaderboardSection.classList.remove('visible'); return; } leaderboardPlaceholder?.remove(); leaderboardSection.classList.add('visible'); leaderboardData.forEach((item, index) => { const rank = index + 1; const row = document.createElement('tr'); row.setAttribute('data-team', item.teamName); const rankCell = document.createElement('td'); rankCell.classList.add('text-center'); rankCell.innerHTML = `<span class="rank-badge">${rank}</span>`; const nameCell = document.createElement('td'); nameCell.classList.add('team-name-cell'); nameCell.textContent = item.teamName; const scoreCell = document.createElement('td'); scoreCell.classList.add('text-center', 'score-display'); scoreCell.textContent = item.score.toFixed(1); row.appendChild(rankCell); row.appendChild(nameCell); row.appendChild(scoreCell); leaderboardBody.appendChild(row); if (item.teamName === highlightTeam) { row.classList.add('highlight-new'); setTimeout(() => { row.classList.remove('highlight-new'); }, 1500); } }); }
            function animateScoreToLeaderboard(teamName, score) { if (!flyingScoreElement || !judgeResultScore || !leaderboardBody) return; const rank = leaderboardData.findIndex(item => item.teamName === teamName) + 1; let targetRow = leaderboardBody.querySelector(`tr:nth-child(${rank})`); let targetY, targetX; const tableRect = leaderboardBody.getBoundingClientRect(); if (targetRow) { const rowRect = targetRow.getBoundingClientRect(); targetY = rowRect.top + (rowRect.height / 2); targetX = rowRect.left + (rowRect.width / 2); } else { targetY = tableRect.top + (rank * 25); targetX = tableRect.left + (tableRect.width / 2); } const startRect = judgeResultScore.getBoundingClientRect(); const startY = startRect.top + (startRect.height / 2); const startX = startRect.left + (startRect.width / 2); flyingScoreElement.textContent = `${score.toFixed(1)}`; flyingScoreElement.style.top = `${startY}px`; flyingScoreElement.style.left = `${startX}px`; flyingScoreElement.style.opacity = '1'; flyingScoreElement.style.transform = 'scale(1)'; requestAnimationFrame(() => { flyingScoreElement.style.top = `${targetY}px`; flyingScoreElement.style.left = `${targetX}px`; flyingScoreElement.style.opacity = '0'; flyingScoreElement.style.transform = 'scale(0.3)'; }); flyingScoreElement.addEventListener('transitionend', () => { flyingScoreElement.style.opacity = '0'; flyingScoreElement.style.transform = 'scale(1)'; renderLeaderboard(teamName); const newlyRenderedRow = leaderboardBody.querySelector(`tr[data-team="${teamName}"]`); if (newlyRenderedRow) { const nameCell = newlyRenderedRow.querySelector('.team-name-cell'); if (nameCell) animateTextWordByWord(nameCell, item.teamName, 75); } }, { once: true }); } // Corrected target for animateTextWordByWord
            if (judgeProjectBtn && judgeTeamSelect && judgeLoader && judgeResultsArea && judgeResultAnalysisList && judgeResultScore) { judgeProjectBtn.addEventListener('click', function() { const selectedTeam = judgeTeamSelect.value; if (!selectedTeam) { judgeResultsArea.style.display = 'block'; judgeLoader.style.display = 'none'; judgeResultTeamName.textContent = "Error"; judgeResultAnalysisList.innerHTML = '<li class="visible" style="border-color: var(--error-color);">Please select a team.</li>'; judgeResultScore.innerHTML = ''; return; } judgeResultsArea.style.display = 'none'; judgeResultAnalysisList.innerHTML = ''; judgeResultScore.innerHTML = ''; judgeLoader.style.display = 'block'; judgeProjectBtn.disabled = true; judgeTeamSelect.disabled = true; leaderboardSection.classList.remove('visible'); const processingTime = 2500; const analysisPoints = teamAnalysisData[selectedTeam] || ["Standard analysis.", "Details pending."]; setTimeout(() => { judgeLoader.style.display = 'none'; judgeResultsArea.style.display = 'block'; judgeResultTeamName.textContent = `Eval: ${selectedTeam}`; const totalDisplayTime = displayAnalysisSequentially(analysisPoints); setTimeout(() => { const score = generateScore(selectedTeam); judgeResultScore.innerHTML = `Score: <span>${score.toFixed(1)}/10</span>`; updateLeaderboardData(selectedTeam, score); setTimeout(() => { animateScoreToLeaderboard(selectedTeam, score); }, 150); judgeProjectBtn.disabled = false; judgeTeamSelect.disabled = false; }, totalDisplayTime + 100); }, processingTime); }); judgeModalElement.addEventListener('shown.bs.modal', () => { renderLeaderboard(); }); } else { console.error("AI Judging elements not found."); }
             // --- END AI Judge & Leaderboard Logic ---

            // --- Smooth Scroll Logic (Optional - Keep existing) ---
            document.querySelectorAll('a[href^="#"]').forEach(link => { link.addEventListener('click', function(e) { const targetId = this.getAttribute('href'); if (targetId && targetId.startsWith('#')) { e.preventDefault(); const targetElement = document.querySelector(targetId); if (targetElement) { targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } }); });
            // --- END Smooth Scroll Logic ---

            // --- Final Initializations ---
            initializeTelegramApp(); // Start the app initialization
            setupLogoScroll();      // Setup logo scroll effect regardless of TG context

        });
    </script>

</body>
</html>
