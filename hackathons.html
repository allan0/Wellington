<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no">
    <!-- ### UPDATED TITLE & META ### -->
    <title>Welly x DAFZ AI Hackathon 2025</title>
    <meta name="description" content="Login, Guide, Tasks, Teams, and AI Judge Simulation for the Wellington Campus x DAFZ AI Hackathon 2025.">
    <meta name="keywords" content="DAFZ, Wellington Campus, hackathon, AI, logistics, supply chain, agenda, judge, leaderboard, profile, points, tasks, welly points, teams, login, web app, backend">
    <meta name="author" content="Wellington Campus & DAFZ">
    <meta property="og:title" content="Welly x DAFZ AI Hackathon 2025 App">
    <meta property="og:description" content="Hackathon App: Login, Guide, Tasks, Teams, Leaderboard & AI Judge.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://allan0.github.io/Wellington/hackathons.html"> <!-- Update if URL changes -->
    <meta property="og:image" content="./wellingtoncampus.png"> <!-- Update Path -->
    <meta property="og:image:alt" content="Wellington Campus Logo">
    <link rel="icon" href="./favicon.ico" type="image/x-icon"> <!-- Update Path -->

    <!-- Stylesheets (Keep Existing) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">

    <style>
        /* --- ALL PREVIOUS CSS Rules are kept --- */
        /* Add specific styles for Login Modal if needed */
        :root {
             /* ... keep previous vars ... */
             --primary-color: #d4af37; /* Gold */
             --secondary-color: #003366; /* Dark Blue */
             /* Or use DAFZ Colors? Example: */
             /* --primary-color: #00A7E1; */ /* DAFZ Blue */
             /* --secondary-color: #F7941E; */ /* DAFZ Orange */
        }
         html { scroll-behavior: smooth; }
        body { font-family: 'Roboto', sans-serif; color: var(--text-color); background-color: var(--bg-color); font-size: 1.0rem; line-height: 1.6; margin: 0; padding: 0; min-height: 100vh; box-sizing: border-box; overflow-x: hidden; padding-bottom: 80px; /* Increased padding? Adjust as needed */ display: flex; flex-direction: column; }
        #main-header { text-align: center; margin-bottom: 1rem; position: relative; padding-top: 1rem; flex-shrink: 0; }
        #header-logo { display: block; margin: 0 auto 0.5rem auto; max-width: 100px; width: 100px; height: auto; position: relative; top: 0; left: 0; z-index: 10; cursor: pointer; transition: all 0.4s ease-in-out; }
        #header-logo.logo-scrolled { position: fixed; top: 8px; left: 12px; width: 45px; max-width: 45px; height: auto; z-index: 1045; margin: 0; background-color: rgba(255, 255, 255, 0.85); padding: 4px; border-radius: 50%; box-shadow: 0 3px 8px rgba(0, 51, 102, 0.3); }
        body.logo-state-scrolled .container { padding-top: 60px; } /* Adjust padding if needed */
        #user-profile { position: fixed; top: 8px; right: 12px; font-size: 0.85rem; color: var(--secondary-color); background-color: rgba(255, 255, 255, 0.9); padding: 5px 12px; border-radius: 20px; display: none; /* Initially hidden */ align-items: center; z-index: 1045; box-shadow: 0 2px 5px rgba(0, 51, 102, 0.15); transition: all 0.4s ease; cursor: pointer; }
        #user-profile:hover { background-color: rgba(235, 235, 235, 0.95); }
        #user-avatar { display: inline-block; width: 28px; height: 28px; border-radius: 50%; margin-right: 8px; vertical-align: middle; background-color: #e9ecef; text-align: center; line-height: 28px; font-size: 18px; overflow: hidden; }
        #user-avatar img { display: block; width: 100%; height: 100%; object-fit: cover; }
        #user-name-display { font-weight: 600; margin-right: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; }
        #welly-points { font-weight: bold; margin-left: 5px; }
        #user-profile .fa-star { margin-left: 5px; color: var(--primary-color); }
        #user-profile-team-name { font-size: 0.75rem; color: #6c757d; margin-left: 5px; font-style: italic; } /* Added */

        .welly-points-gain { position: fixed; z-index: 1100; color: var(--primary-color); font-weight: bold; font-size: 1.1rem; padding: 3px 8px; background-color: rgba(255, 255, 255, 0.9); border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); opacity: 0; transition: all 0.8s ease-out; pointer-events: none; white-space: nowrap; transform: translateX(-50%); }
        .bottom-nav { display: none; /* Initially hidden */ flex; position: fixed; bottom: 0; left: 0; right: 0; width: 100%; background-color: var(--bottom-nav-bg); box-shadow: 0 -2px 10px rgba(0,0,0,0.1); padding: 0.5rem 0; z-index: 1040; flex-shrink: 0; }
        .floating-button { position: fixed; width: 55px; height: 55px; font-size: 1.6rem; z-index: 1050; background-color: var(--secondary-color); color: var(--accent-color); border: 2px solid var(--primary-color); border-radius: 50%; display: none; /* Initially hidden */ justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0, 51, 102, 0.4); cursor: pointer; transition: all 0.3s ease; }
        .floating-button:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0, 51, 102, 0.6); }
        #task-tracker-btn { left: 15px; bottom: 75px; }
        #ai-judge-btn { right: 15px; bottom: 75px; background-color: var(--primary-color); color: var(--secondary-color); border-color: var(--secondary-color); }
        #task-tracker-btn:hover { background-color: #004a8d; }
        #ai-judge-btn:hover { background-color: #b8860b; color: var(--secondary-color); }
        .container { flex-grow: 1; width: 100%; }
        h1, h2, h3, h4, h5 { font-family: 'Poppins', sans-serif; color: var(--secondary-color); margin-top: 1.2rem; margin-bottom: 0.8rem; }
        /* ### Update Hackathon Title Style ### */
        h1 { color: var(--secondary-color); font-size: 1.6rem; } /* Slightly smaller */
        h1 .fa-cogs { color: var(--primary-color); }
        .hackathon-subtitle { color: var(--secondary-color); font-size: 1.0rem; font-weight: 400; margin-bottom: 1.5rem; }
        .card { border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 1.2rem; border: none; background-color: var(--card-bg-color); overflow: hidden; }
        .card-header { background-color: var(--secondary-color); color: var(--accent-color); font-weight: 600; border-bottom: 3px solid var(--primary-color); padding: 0.8rem 1.2rem; display: flex; align-items: center; justify-content: space-between; transition: background-color 0.2s ease; }
        .card-header h2 { color: var(--accent-color); margin: 0; font-size: 1.1rem; }
        .card-header i { margin-right: 0.6rem; font-size: 1rem; }
        .card-header[data-bs-toggle="collapse"] { cursor: pointer; }
        .card-header[data-bs-toggle="collapse"]:hover { background-color: #004a8d; }
        .card-header .chevron-icon { font-size: 0.9rem; transition: transform 0.3s ease; margin-left: auto; padding-left: 1rem; }
        .card-header .chevron-down { display: inline-block; } .card-header .chevron-up { display: none; }
        .card-header.collapsed .chevron-down { display: inline-block; } .card-header.collapsed .chevron-up { display: none; }
        .card-header:not(.collapsed) .chevron-down { display: none; } .card-header:not(.collapsed) .chevron-up { display: inline-block; transform: rotate(180deg); }
        .card-body { padding: 1.2rem; }
        .list-unstyled li, .list-group-item { margin-bottom: 0.7rem; display: flex; align-items: flex-start; line-height: 1.5; font-size: 0.95rem; }
        .list-unstyled i.fas, .list-unstyled i.fab, .list-group-item i.fas { color: var(--primary-color); margin-right: 0.8rem; width: 18px; text-align: center; flex-shrink: 0; margin-top: 0.15em; }
        .checklist { padding-left: 0; list-style: none; margin-top: 1rem; }
        .checklist-item { background-color: #e9ecef; padding: 0.8rem 1rem; border-radius: 8px; margin-bottom: 0.6rem; transition: all 0.3s ease; display: flex; align-items: center; line-height: 1.4; border-left: 4px solid var(--secondary-color); cursor: pointer; font-size: 0.9rem; }
        .checklist-item:hover { background-color: #dfe6ec; }
        .checklist-item i.fa-circle { color: var(--secondary-color); margin-right: 0.75rem; font-size: 1em; transition: transform 0.2s ease; }
        .checklist-item i.fa-check-circle { color: var(--success-color); display: none; margin-right: 0.75rem; font-size: 1em; transition: transform 0.2s ease; }
        .checklist-item.completed { background-color: #d1e7dd; color: #0f5132; border-left: 4px solid var(--success-color); cursor: default; }
        .checklist-item.completed i.fa-circle { display: none; }
        .checklist-item.completed i.fa-check-circle { display: inline-block; transform: scale(1.1); }
        .celebration-emoji { display: inline-block; margin-left: 10px; font-size: 1.2em; opacity: 0; transform: scale(0.5); transition: opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .checklist-item.completed .celebration-emoji { opacity: 1; transform: scale(1); }
        .progress { height: 18px; font-size: 0.75rem; border-radius: 50px; background-color: #e9ecef; }
        .progress-bar { background-color: var(--primary-color); font-weight: bold; color: var(--accent-color); display: flex; align-items: center; justify-content: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); transition: width 0.6s ease; }
        .agenda-list { list-style: none; padding-left: 0; }
        .agenda-list li { margin-bottom: 1rem; display: flex; align-items: flex-start; }
        .agenda-time { flex: 0 0 70px; font-weight: bold; color: var(--secondary-color); display: flex; align-items: center; font-size: 0.9em; }
        .agenda-time i { margin-right: 5px; width: 15px; text-align: center;}
        .agenda-details { flex-grow: 1; margin-left: 10px; }
        .agenda-details strong { display: block; font-size: 0.95em; }
        .agenda-details p { font-size: 0.85em; margin-bottom: 0; color: #555; line-height: 1.3; }
        .agenda-speaker { flex: 0 0 100px; text-align: right; font-size: 0.8em; color: #6c757d; font-style: italic; margin-left: 10px; }
        .agenda-break { background-color: rgba(212,175,55,0.1); padding: 5px 0; border-left: 3px solid var(--primary-color); border-radius: 4px; margin-left: 5px; }
        .agenda-break .agenda-time { color: var(--primary-color); }
        #task-message-area .alert { margin-top: 1rem; padding: 0.7rem 1rem; font-size: 0.9rem; }
        #aiJudgeModal .modal-body { min-height: 300px; }
        #judgeLoader { text-align: center; padding: 1rem 0; display: none; }
        #judgeLoader p { margin-top: 0.8rem; color: var(--secondary-color); font-style: italic; font-size: 0.9rem;}
        #judgeResultsArea { display: none; }
        #judgeResultTeamName { margin-bottom: 0.5rem; color: var(--secondary-color); font-weight: bold;}
        #judgeResultAnalysis { margin-bottom: 1rem; }
        #judgeResultAnalysisList li { margin-bottom: 0.3rem; opacity: 0; transition: opacity 0.4s ease-in; padding-left: 1em; position: relative;}
        #judgeResultAnalysisList li::before { content: '‚úì'; position: absolute; left: 0; color: var(--success-color); font-weight: bold;}
        #judgeResultAnalysisList li.visible { opacity: 1; }
        #judgeResultScore { font-size: 1.1rem; font-weight: bold; color: var(--primary-color); text-align: center; margin-top: 1rem; padding: 0.5rem; background-color: rgba(0,51,102,0.05); border-radius: 5px;}
        #groupsLeaderboardSection { margin-top: 1rem; }
        #aiLeaderboardTable th, #aiLeaderboardTable td { padding: 0.5rem; vertical-align: middle; font-size: 0.85rem; } /* Smaller font */
        .rank-badge { display: inline-block; width: 22px; height: 22px; line-height: 22px; text-align: center; border-radius: 50%; background-color: var(--primary-color); color: var(--accent-color); font-weight: bold; font-size: 0.8em; }
        #ai-leaderboard-body tr:nth-child(1) .rank-badge { background-color: #ffd700; color: #333;}
        #ai-leaderboard-body tr:nth-child(2) .rank-badge { background-color: #c0c0c0; color: #333;}
        #ai-leaderboard-body tr:nth-child(3) .rank-badge { background-color: #cd7f32; color: #fff;}
        #ai-leaderboard-body .team-lead { font-style: italic; color: #6c757d; display: block; margin-top: 2px; font-size: 0.9em; }
        #flying-score-element { position: absolute; z-index: 1100; font-size: 1.2rem; font-weight: bold; color: var(--primary-color); background: rgba(255,255,255,0.9); padding: 5px 10px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); opacity: 0; transition: all 0.6s ease-in-out; pointer-events: none; transform-origin: center center; }
        .bottom-nav .btn { color: var(--bottom-nav-icon); background-color: transparent; border: none; padding: 0.5rem; font-size: 0.85rem; display: flex; flex-direction: column; align-items: center; transition: color 0.3s ease; text-decoration: none; }
        .bottom-nav i { font-size: 1.1rem; margin-bottom: 0.15rem; }
        .bottom-nav .btn.active { color: var(--bottom-nav-active); font-weight: 600;}
        .task-points { font-size: 0.75rem; font-weight: bold; color: var(--accent-color); background-color: var(--primary-color); padding: 2px 6px; border-radius: 10px; margin-left: auto; margin-right: 5px; white-space: nowrap; }
        .checklist-item.completed .task-points { background-color: var(--success-color); color: var(--accent-color); }
        .btn-custom { background-color: var(--primary-color); color: var(--accent-color) !important; border: none; padding: 0.6rem 1.5rem; border-radius: 25px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(212,175,55,0.3); font-weight: 600; text-decoration: none; display: inline-block; }
        .btn-custom:hover { background-color: #b8860b; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(212,175,55,0.4); color: var(--accent-color) !important; }
        .btn-custom.btn-lg { padding: 0.8rem 2rem; font-size: 1.1rem; }
        /* Registration form elements can be kept for potential future 'update profile' feature, but hide related buttons/sections initially */
        #registrationModal .modal-footer { justify-content: space-between; }
        .form-control-sm, .form-select-sm { font-size: 0.9rem; }
        #userProfileModal .modal-header { background-color: var(--secondary-color); color: var(--accent-color); border-bottom: 3px solid var(--primary-color); }
        #userProfileModal .modal-header .btn-close { filter: invert(1) grayscale(100%) brightness(200%); }
        #userProfileModal .modal-body { text-align: center; }
        #modal-user-avatar { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 0.5rem auto; display: block; background-color: #e9ecef; font-size: 40px; line-height: 80px; overflow: hidden; border: 3px solid var(--primary-color); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        #modal-user-avatar img { width: 100%; height: 100%; object-fit: cover; }
        #modal-user-name { font-size: 1.3rem; font-weight: 600; color: var(--secondary-color); margin-bottom: 0.2rem; }
        #modal-welly-points-display { font-size: 1.8rem; font-weight: bold; color: var(--primary-color); margin-bottom: 1rem; }
        #modal-welly-points-display .fa-star { font-size: 1.5rem; margin-right: 5px; vertical-align: middle; }
        #profile-rank-display { font-size: 0.95rem; color: var(--text-color); margin-bottom: 0.5rem; background-color: rgba(0, 51, 102, 0.05); padding: 0.5rem; border-radius: 8px; border-left: 4px solid var(--secondary-color); }
        #profile-team-display { font-size: 1.1rem; /* Larger team name */ margin-bottom: 0.3rem; font-weight: bold; }
        #profile-team-members-display { font-size: 0.9rem; margin-bottom: 1.5rem; list-style: none; padding-left: 0; } /* For team members list */
         #profile-team-members-display li { margin-bottom: 0.2rem; }
         #profile-team-members-display .badge { margin-left: 5px; }

        #profile-leaderboard-section h5 { color: var(--secondary-color); margin-bottom: 0.8rem; font-size: 1.1rem; }
        #profile-leaderboard-table { font-size: 0.9rem; }
        #profile-leaderboard-table thead { background-color: var(--secondary-color); color: var(--accent-color); }
        #profile-leaderboard-body tr td { vertical-align: middle; }
        #profile-leaderboard-body .rank-badge { }
        #profile-leaderboard-body tr:nth-child(1) .rank-badge { background-color: #ffd700; color: #333; }
        #profile-leaderboard-body tr:nth-child(2) .rank-badge { background-color: #c0c0c0; color: #333; }
        #profile-leaderboard-body tr:nth-child(3) .rank-badge { background-color: #cd7f32; color: #fff; }
        #profile-leaderboard-body .points-cell { font-weight: bold; color: var(--secondary-color); text-align: right; }
        #profile-leaderboard-body tr.table-info { background-color: rgba(212, 175, 55, 0.15) !important; font-weight: bold; }
        #reset-progress-btn { background-color: var(--danger-color); border-color: var(--danger-color); color: white; transition: all 0.2s ease; }
        #reset-progress-btn:hover { background-color: #c82333; border-color: #bd2130; }
        #reset-progress-btn:disabled { background-color: #6c757d; border-color: #6c757d; opacity: 0.65; cursor: not-allowed; }
        #leaderboard-loading, #leaderboard-empty, #ai-leaderboard-loading, #ai-leaderboard-empty { color: #6c757d; font-style: italic; padding: 1rem 0; text-align: center; }
        #reset-feedback { font-size: 0.85rem; margin-top: 5px; min-height: 1.2rem; font-weight: 500; text-align: left; }
        .feedback-success { color: var(--success-color); }
        .feedback-error { color: var(--danger-color); }
        .feedback-info { color: var(--info-color); }
        .feedback-warning { color: var(--warning-color); }
        .text-muted { color: #6c757d !important; }
        .modal-dialog-scrollable .modal-body { overflow-y: auto; }

        /* Added styles for loading overlay */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; /* High z-index */
            flex-direction: column;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #loading-overlay.show { opacity: 1; visibility: visible; }
        #loading-overlay p { margin-top: 1rem; font-weight: 500; color: var(--secondary-color); }

        /* Hide main content initially */
        #main-app-content { display: none; }

         /* Team Emojis Styling */
         .team-emoji { font-size: 1.2em; margin-right: 5px; vertical-align: middle; }
         .leader-emoji { font-size: 1em; margin-left: 3px; }
         #profile-team-members-display .leader-emoji { vertical-align: baseline;}

        /* Ensure Hackathon Guide text uses normal line height */
         #hackathon-guide .card-body, #hackathon-guide p, #hackathon-guide li {
             line-height: 1.6;
             font-size: 0.95rem;
         }
         #hackathon-guide h3, #hackathon-guide h4, #hackathon-guide h5 {
              margin-top: 1.5rem;
              margin-bottom: 0.5rem;
         }
         #hackathon-guide strong { color: var(--secondary-color); }
         #hackathon-guide ul { padding-left: 1.5rem; margin-top: 0.5rem;}

    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p>Loading Hackathon Data...</p>
    </div>

     <!-- Login Modal (Shown First) -->
    <div class="modal fade" id="loginModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel"><img src="./wellingtoncampus.png" alt="Logo" height="30" class="me-2">Welly x DAFZ Hackathon Login</h5>
                     <!-- No close button initially -->
                </div>
                <div class="modal-body">
                    <p class="text-center small mb-3">Enter your registered phone number (lead's phone from registration) or 'admin' to access the Hackathon App.</p>
                    <div class="mb-3">
                        <label for="loginPhoneInput" class="form-label small">Phone Number / Admin:</label>
                        <input type="text" class="form-control" id="loginPhoneInput" placeholder="e.g., +9715XXXXXXXX or admin" required>
                    </div>
                    <!-- Simple Password for Admin -->
                     <div class="mb-3" id="adminPasswordGroup" style="display: none;">
                         <label for="adminPasswordInput" class="form-label small">Admin Password:</label>
                         <input type="password" class="form-control" id="adminPasswordInput" placeholder="Enter admin password">
                     </div>
                    <div id="loginFeedback" class="text-center mt-3 small" style="min-height: 20px;"></div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary" id="loginSubmitBtn"><i class="fas fa-sign-in-alt me-1"></i> Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ### MAIN APP CONTENT - Initially Hidden ### -->
    <div id="main-app-content">

        <!-- User Profile Display (Top Right) - Managed by JS -->
        <div id="user-profile" data-bs-toggle="modal" data-bs-target="#userProfileModal">
            <span id="user-avatar">üë§</span>
            <span id="user-name-display">Player</span>
            <span id="user-profile-team-name"></span> <!-- Team Name Display Added -->
            | <i class="fas fa-star"></i>
            <span id="welly-points">0</span> WP
        </div>

        <!-- Main Content Container -->
        <div class="container mt-2" id="hackathon">

            <!-- Header Section -->
            <header id="main-header">
                 <img src="./wellingtoncampus.png" alt="Wellington Campus Logo" id="header-logo">
                <!-- ### UPDATED HEADER ### -->
                <h1><i class="fas fa-cogs me-2"></i>Wellington Campus x DAFZ AI Hackathon 2025</h1>
                <p class="hackathon-subtitle">Theme: AI-Driven Solutions for Supply Chain and Logistics</p>
            </header>

            <!-- Registration Button Section - Hidden/Disabled -->
            <section id="registration-action" class="text-center mb-4" style="display: none;">
                 <!-- Keep the structure for potential future use but hide -->
                <button class="btn btn-custom btn-lg" id="registerTeamBtn" data-bs-toggle="modal" data-bs-target="#registrationModal" disabled>
                    Register / Join Team
                </button>
                 <p id="registration-status-message" class="small text-muted mt-1 fst-italic"></p>
            </section>

            <!-- Progress Bar Section -->
             <section id="progress" class="mb-3 card">
                 <div class="card-header"> <h2><i class="fas fa-tasks"></i>Progress & Points</h2> </div>
                 <div class="card-body">
                      <!-- Updated Text -->
                     <p class="small mb-2">Welcome! Track your tasks via <i class="fas fa-tasks"></i> button & earn WP for completed steps.</p>
                     <div class="progress" role="progressbar" aria-label="Hackathon Progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                         <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%">0%</div>
                     </div>
                 </div>
            </section>

            <!-- Quick Info Section - Updated -->
            <section id="quick-info" class="card mb-3">
                 <div class="card-body">
                     <h3><i class="fas fa-bolt me-2"></i>Quick Info</h3>
                     <ul class="list-unstyled">
                          <li><i class="fas fa-flag-checkered"></i> <strong>Event:</strong> Wellington Campus x DAFZ AI Hackathon 2025</li>
                         <li><i class="fas fa-calendar-day"></i> <strong>Date:</strong> Wed, Apr 23, 2025</li>
                         <li><i class="fas fa-clock"></i> <strong>Time:</strong> 08:30 - 14:00</li>
                         <li><i class="fas fa-map-marker-alt"></i> <strong>Venue:</strong> Dubai Airport Free Zone (DAFZ)</li>
                          <li><i class="fas fa-bullseye"></i> <strong>Theme:</strong> AI in Supply Chain & Logistics</li>
                     </ul>
                 </div>
            </section>

            <!-- Collapsible Sections -->
            <div id="accordionHackathon">

                <!-- NEW: Hackathon Guide Section -->
                 <section id="hackathon-guide" class="card mb-3">
                    <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseGuide" aria-expanded="false" aria-controls="collapseGuide">
                         <h2><i class="fas fa-book-open"></i>Participant Guide & Challenges</h2>
                         <span class="chevron-icon ms-auto"><i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span>
                    </div>
                    <div class="collapse" id="collapseGuide" data-bs-parent="#accordionHackathon">
                         <div class="card-body">
                              <!-- ### PASTE UPDATED GUIDE CONTENT HERE ### -->
                              <h4>Welcome to the Wellington Campus x DAFZ AI Hackathon 2025!</h4>
                             <p>Get ready for an exciting opportunity to innovate and collaborate! This guide provides all the details you need to succeed, including expectations, challenges, deliverables, and tips for creating impactful AI-driven solutions for logistics challenges in cross-border trade and e-commerce.</p>
                             <p>You‚Äôll work in teams to tackle one of the provided problem statements, using mock datasets (generated by you) and your creativity to build simple yet innovative solutions within the 5-hour sprint.</p>

                             <h5><i class="fas fa-info-circle"></i> Hackathon Overview</h5>
                              <p><strong>Objective:</strong> Develop AI-based tools or logic to solve logistics challenges, such as optimizing delivery routes, managing inventory, or predicting returns. Challenges are designed to be accessible for students with foundational AI/ML and programming skills (e.g., Python basics) while encouraging creativity.</p>
                             <p><strong>Format:</strong></p>
                             <ul>
                                  <li><strong>Teams:</strong> Pre-qualified teams (view your team in the profile <i class="fas fa-user-circle"></i>). Max 4 members.</li>
                                  <li><strong>Challenges:</strong> Assigned at 09:20. Choose from predefined problem statements or a simplified alternative.</li>
                              </ul>
                              <p><strong>Deliverables:</strong></p>
                             <ul>
                                  <li><strong>Working Logic/Model:</strong> Python script, Jupyter Notebook, Excel sheet, or flowchart.</li>
                                 <li><strong>Presentation Deck:</strong> 3‚Äì5 slides summarizing your solution.</li>
                                 <li><strong>5-Minute Pitch:</strong> A clear and persuasive presentation of your solution.</li>
                              </ul>
                              <p><strong>Resources:</strong></p>
                              <ul>
                                  <li><strong>Mock Datasets:</strong> Downloadable link provided at 09:30 (Hackathon_Challenge_Notebooks.zip). Includes README.txt and Jupyter Notebooks to generate data.</li>
                                  <li><strong>Support:</strong> Access to mentors, pitch coaches, and a help desk.</li>
                              </ul>
                              <p><strong>Recommended Tools:</strong></p>
                              <ul>
                                  <li>Python 3.8+ with libraries (pandas, scikit-learn, matplotlib, etc. - see README.txt in zip).</li>
                                  <li>Jupyter Notebook/JupyterLab (install via pip).</li>
                                  <li>Git/GitHub for version control.</li>
                                  <li>Excel for quick prototypes.</li>
                                  <li>Optional: Figma/Canva for UI mock-ups.</li>
                              </ul>
                               <p><strong>Evaluation Criteria:</strong></p>
                              <ul>
                                  <li>Technical Feasibility (30%): Does the logic work with the generated data?</li>
                                 <li>Innovation (25%): How creative is the approach?</li>
                                 <li>Impact (25%): Does it address the problem effectively?</li>
                                 <li>Pitch/Demo (20%): Clarity and persuasiveness of the presentation.</li>
                              </ul>


                              <h5><i class="fas fa-tasks"></i> Challenges</h5>
                              <p>If you're passionate about supply chain management and the logistics industry, here's your chance to dive in and make a real impact. Below, you'll find two key problem areas along with simplified versions. Use the provided notebooks to generate mock data specific to your assigned challenge.</p>
                                <p>Take inspiration from sample solutions (discussed during briefing), but don‚Äôt stop there‚Äîuse your own insights, imagination, and market understanding to come up with innovative solutions!</p>
                               <ul>
                                   <li><strong>Problem Statement 1: AI-Based Smart Redistribution Plan</strong><br>Objective: Use the generated mock dataset to create a redistribution plan for inventory across warehouses.</li>
                                   <li><strong>Problem Statement 2: AI-Powered Route Optimization</strong><br>Objective: Use generated mock datasets to optimize delivery routes for efficiency.</li>
                                   <li><strong>Simplified Alternative Challenges:</strong>
                                       <ul>
                                           <li>AI Chatbot: Build a chatbot for logistics queries using generated data.</li>
                                           <li>Smart Product Recommender: Recommend products based on user behavior using generated data.</li>
                                           <li>Returns Prediction Tool: Predict potential returns using generated data.</li>
                                       </ul>
                                   </li>
                               </ul>

                               <h5><i class="fas fa-file-alt"></i> Deliverables in Detail</h5>
                                <ol>
                                   <li><strong>Working Logic/Model:</strong> Python script, Jupyter Notebook, Excel, or flowchart. Should process the generated mock dataset and produce relevant outputs. <em>Tip: Keep it simple! Test often.</em></li>
                                   <li><strong>Presentation Deck (3‚Äì5 Slides):</strong> Summarize problem, solution, tech approach, impact.</li>
                                   <li><strong>5-Minute Pitch:</strong> Present clearly and persuasively.</li>
                                </ol>

                                <h5><i class="fas fa-lightbulb"></i> Tips for Success</h5>
                                <ul>
                                    <li><strong>Start Simple:</strong> Build a minimal viable solution first.</li>
                                    <li><strong>Generate & Leverage Datasets (Crucial at 09:30!):</strong>
                                        <ul>
                                             <li>Download `Hackathon_Challenge_Notebooks.zip`.</li>
                                             <li><strong>Follow `README.txt`</strong> to set up your environment (virtual env, `pip install pandas numpy faker jupyterlab`).</li>
                                             <li>Run the appropriate `.ipynb` notebook to generate `.csv` data files.</li>
                                             <li>Explore the data early!</li>
                                        </ul>
                                    </li>
                                    <li><strong>Collaborate:</strong> Divide tasks within your team.</li>
                                    <li><strong>Use Mentors & Help Desk:</strong> Get feedback or help with setup/data issues.</li>
                                     <li><strong>Time Management is Key!</strong> Follow the agenda timings.</li>
                                </ul>

                               <h5><i class="fas fa-headset"></i> Support and Resources</h5>
                                <ul>
                                   <li>Mentors, Help Desk, Pitch Coach available.</li>
                                   <li>Datasets: Link for `Hackathon_Challenge_Notebooks.zip` provided at 09:30. <strong>READ THE README.TXT!</strong></li>
                                   <li>Software: Python 3.8+, Jupyter, optionally Git, common data science libs (install via pip, see README.txt), Excel, Figma/Canva.</li>
                                </ul>


                               <h5><i class="fas fa-question-circle"></i> FAQs</h5>
                                <p><strong>Q: Do I need advanced AI knowledge?</strong><br>A: No! Basic Python and familiarity with simple concepts are enough. Focus on creativity and clear logic. Follow the `README.txt` for setup.</p>
                               <p><strong>Q: Can I choose my challenge?</strong><br>A: Challenges are assigned, but you tailor your solution within the problem statement.</p>
                                <p><strong>Q: What if I get stuck during setup or data generation?</strong><br>A: Check `README.txt` first! Then, contact the Help Desk or Mentors immediately.</p>
                                <p><strong>Q: What if I get stuck on the challenge itself?</strong><br>A: Consult mentors, simplify your approach (e.g., rule-based), use the Help Desk.</p>
                                <p><strong>Q: How do I submit?</strong><br>A: Upload your code/logic file and presentation deck via the provided link by 14:00.</p>

                                <h5>Let‚Äôs Innovate Together!</h5>
                                <p>We‚Äôre thrilled to see the creative solutions you‚Äôll bring. Good luck, and have fun!</p>
                                <em>- Wellington Campus & DAFZ Team</em>

                         </div>
                     </div>
                 </section>

                <!-- Agenda -->
                <section id="agenda" class="card mb-3">
                     <div class="card-header" data-bs-toggle="collapse" data-bs-target="#collapseAgenda" aria-expanded="true" aria-controls="collapseAgenda"> <h2><i class="fas fa-calendar-alt"></i>Agenda Snapshot</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div>
                     <div class="collapse show" id="collapseAgenda" data-bs-parent="#accordionHackathon">
                         <div class="card-body">
                             <!-- ### UPDATED AGENDA ### -->
                             <h3 class="mb-3 mt-0 small" style="color: var(--primary-color);"><i class="fas fa-flag-checkered me-2"></i>Wednesday, 23rd April 2025</h3>
                             <ul class="agenda-list">
                                  <li> <span class="agenda-time"><i class="fas fa-sign-in-alt"></i>08:30</span> <span class="agenda-details"><strong>Check-in & Registration Confirmation</strong><p>Confirm attendance, get kits.</p></span> <span class="agenda-speaker"><small>On Site</small></span> </li>
                                  <li> <span class="agenda-time"><i class="fas fa-users"></i>08:45</span> <span class="agenda-details"><strong>Team Area Finalization</strong><p>Find your assigned team spot.</p></span> <span class="agenda-speaker"><small>Facilitated</small></span> </li>
                                  <li> <span class="agenda-time"><i class="fas fa-bullhorn"></i>09:00</span> <span class="agenda-details"><strong>Opening Speech & Welcome</strong><p>Kick-off by Wellington & DAFZ.</p></span> <span class="agenda-speaker"><small>Host</small></span> </li>
                                 <li> <span class="agenda-time"><i class="fas fa-scroll"></i>09:05</span> <span class="agenda-details"><strong>Hackathon Brief & Rules</strong><p>Guide review, Code of Conduct, IP.</p></span> <span class="agenda-speaker"><small>Coordinator</small></span> </li>
                                  <li> <span class="agenda-time"><i class="fas fa-dice"></i>09:20</span> <span class="agenda-details"><strong>Challenge Assignment</strong><p>Receive your specific problem statement.</p></span> <span class="agenda-speaker"><small>Facilitated</small></span> </li>
                                 <li> <span class="agenda-time"><i class="fas fa-laptop-code"></i>09:30</span> <span class="agenda-details"><strong>Hacking Begins! + Dataset Access</strong><p>Download zip, follow README!</p></span> <span class="agenda-speaker">-</span> </li>
                                  <li class="agenda-break"> <span class="agenda-time"><i class="fas fa-download"></i>09:30</span> <span class="agenda-details"><strong>Environment Setup & Data Generation</strong><p>Follow README.txt - CRITICAL STEP.</p></span> <span class="agenda-speaker"><small>All Teams</small></span> </li>
                                  <li class="agenda-break"> <span class="agenda-time"><i class="fas fa-headset"></i>10:00</span> <span class="agenda-details"><strong>Mentors Available / Hacking Continues</strong><p>Seek help if stuck on setup/data/logic.</p></span> <span class="agenda-speaker"><small>Support Team</small></span> </li>
                                 <li class="agenda-break"> <span class="agenda-time"><i class="fas fa-utensils"></i>~12:30</span> <span class="agenda-details"><strong>Lunch Break</strong></span> <span class="agenda-speaker">-</span> </li>
                                  <li> <span class="agenda-time"><i class="fas fa-flag-checkered"></i>14:00</span> <span class="agenda-details"><strong>Stop Hacking & Submit Drafts</strong><p>Upload logic/code + presentation draft.</p></span> <span class="agenda-speaker"><small>Via Link</small></span> </li>
                             </ul>
                         </div>
                     </div>
                </section>

                <!-- Prizes -->
                <section id="prizes" class="card mb-3">
                    <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapsePrizes" aria-expanded="false" aria-controls="collapsePrizes"> <h2><i class="fas fa-trophy"></i>Prizes & Recognition</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div>
                     <div class="collapse" id="collapsePrizes" data-bs-parent="#accordionHackathon">
                        <div class="card-body">
                             <!-- ### UPDATED PRIZES ### -->
                            <p>Win exciting prizes and gain valuable experience!</p>
                            <ul class="list-unstyled small">
                                 <li><i class="fas fa-trophy text-warning"></i> <strong>1st Place:</strong> AED 20,000 Cash Prize + Internship Opportunity + Swag</li>
                                <li><i class="fas fa-medal" style="color: silver;"></i> <strong>2nd Place:</strong> Significant Cash Prize + Swag</li>
                                 <li><i class="fas fa-award" style="color: #cd7f32;"></i> <strong>3rd Place:</strong> Cash Prize + Swag</li>
                                <li><i class="fas fa-lightbulb"></i> <strong>Innovation Award:</strong> Special Recognition</li>
                                 <li><i class="fas fa-gifts"></i> <strong>All Participants:</strong> Certificate of Participation & Hackathon Swag</li>
                                <li><i class="fas fa-handshake"></i> <strong>Opportunity:</strong> Network with industry professionals from DAFZ & Wellington.</li>
                            </ul>
                         </div>
                     </div>
                 </section>

                 <!-- Existing Sections (Keep/Adjust if needed) -->
                <section id="support" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseSupport" aria-expanded="false" aria-controls="collapseSupport"> <h2><i class="fas fa-hands-helping"></i>Support Team</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseSupport" data-bs-parent="#accordionHackathon"> <div class="card-body"> <ul class="list-unstyled"> <li><i class="fas fa-chalkboard-teacher"></i> Mentors (Technical & Business)</li> <li><i class="fas fa-headset"></i> Help Desk (Setup, Data Issues)</li> <li><i class="fas fa-microphone-alt"></i> Pitch Coaching</li> <li><i class="fas fa-folder-open"></i> Resource Access (Guide, Datasets)</li> </ul> </div> </div> </section>
                <section id="judging" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseJudging" aria-expanded="false" aria-controls="collapseJudging"> <h2><i class="fas fa-gavel"></i>Judging Criteria</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseJudging" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">Judging (Day 2) based on:</p> <ul class="list-unstyled small"> <li><i class="fas fa-cogs"></i> Technical Feasibility (30%)</li> <li><i class="fas fa-lightbulb"></i> Innovation (25%)</li> <li><i class="fas fa-bullseye"></i> Impact & Relevance (25%)</li> <li><i class="fas fa-presentation"></i> Pitch/Demo Clarity (20%)</li> <li><i class="fas fa-check-circle"></i> Completion & Use of Data</li> </ul> <p class="small mt-2">Note: The AI Judge Sim (<i class="fas fa-gavel"></i> button) provides *simulated* scores for teams based on backend/local data.</p> </div> </div> </section>
                <section id="contact" class="card mb-3"> <div class="card-header collapsed" data-bs-toggle="collapse" data-bs-target="#collapseContact" aria-expanded="false" aria-controls="collapseContact"> <h2><i class="fas fa-envelope"></i>Contact (On Site)</h2> <span class="chevron-icon ms-auto"> <i class="fas fa-chevron-down chevron-down"></i><i class="fas fa-chevron-up chevron-up"></i></span> </div> <div class="collapse" id="collapseContact" data-bs-parent="#accordionHackathon"> <div class="card-body"> <p class="small">For urgent issues during the event, please approach:</p> <ul class="list-unstyled small"> <li><i class="fas fa-headset"></i> The <strong>Help Desk</strong> near the registration area.</li> <li><i class="fas fa-user-tie"></i> Any staff member with a <strong>Wellington/DAFZ badge</strong>.</li> <li><i class="fas fa-chalkboard-teacher"></i> Your assigned <strong>Mentor</strong>.</li></ul> </div> </div> </section>

            </div> <!-- End Accordion -->

            <!-- Footer -->
             <footer class="text-center mt-4 mb-3 text-muted">
                <small>¬© 2025 Wellington Campus & DAFZ</small>
             </footer>

        </div> <!-- End Main Container -->

        <!-- Floating Buttons (Managed by JS) -->
        <button class="floating-button" id="task-tracker-btn" title="Task Tracker" data-bs-toggle="modal" data-bs-target="#taskTrackerModal">
            <i class="fas fa-tasks"></i>
        </button>
        <button class="floating-button" id="ai-judge-btn" title="Teams & AI Judge Sim" data-bs-toggle="modal" data-bs-target="#aiJudgeModal">
            <i class="fas fa-users-cog"></i> <!-- Changed Icon -->
        </button>

        <!-- Task Tracker Modal -->
        <div class="modal fade" id="taskTrackerModal" tabindex="-1" aria-labelledby="taskTrackerModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="taskTrackerModalLabel"><i class="fas fa-tasks me-2"></i>Your Tasks & Points</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                         <!-- Update task text -->
                         <p class="text-muted small">Click an incomplete task to mark it done and earn Welly Points (WP)! Your progress is saved.</p>
                        <div id="task-message-area" class="mb-3"></div>
                         <div class="checklist" id="modal-checklist">
                            <!-- Example Task Updates -->
                             <div class="checklist-item" data-task-id="checkin" data-points="5"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Check-in Complete</strong></div> <span class="task-points">+5 WP</span><span class="celebration-emoji">‚úÖ</span></div>
                            <div class="checklist-item" data-task-id="team_found" data-points="5"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Found Team Spot</strong></div> <span class="task-points">+5 WP</span><span class="celebration-emoji">üìç</span></div>
                            <div class="checklist-item" data-task-id="briefing" data-points="10"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Attend Briefing & Rules</strong></div> <span class="task-points">+10 WP</span><span class="celebration-emoji">üëÇ</span></div>
                            <div class="checklist-item" data-task-id="challenge" data-points="10"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Received Challenge Assignment</strong></div> <span class="task-points">+10 WP</span><span class="celebration-emoji">üéØ</span></div>
                             <div class="checklist-item" data-task-id="dataset_setup" data-points="20"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Downloaded Zip & Followed README <small>(Env Setup & Data Generated!)</small></strong></div> <span class="task-points">+20 WP</span><span class="celebration-emoji">‚öôÔ∏è</span></div>
                             <div class="checklist-item" data-task-id="brainstorm" data-points="15"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Plan Initial Approach (Post-Data Gen)</strong></div> <span class="task-points">+15 WP</span><span class="celebration-emoji">üí°</span></div>
                            <div class="checklist-item" data-task-id="mentor-meet" data-points="10"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Meet Mentor (Intro/Check-in)</strong></div> <span class="task-points">+10 WP</span><span class="celebration-emoji">üë®‚Äçüè´</span></div>
                             <div class="checklist-item" data-task-id="logic-dev" data-points="25"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Develop Logic/Model (Draft)</strong></div> <span class="task-points">+25 WP</span><span class="celebration-emoji">üíª</span></div>
                            <div class="checklist-item" data-task-id="deck-start" data-points="15"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Start Pitch Deck (Draft)</strong></div> <span class="task-points">+15 WP</span><span class="celebration-emoji">üìä</span></div>
                             <div class="checklist-item" data-task-id="pitch-coach" data-points="10"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Pitch Coach Session (Optional Check-in)</strong></div> <span class="task-points">+10 WP</span><span class="celebration-emoji">üé§</span></div>
                            <div class="checklist-item" data-task-id="day1-submit" data-points="25"> <i class="far fa-circle"></i><i class="far fa-check-circle"></i> <div><strong>Submit Day 1 Drafts (Logic & Deck)</strong></div> <span class="task-points">+25 WP</span><span class="celebration-emoji">üöÄ</span></div>
                         </div>
                        <p class="small text-muted mt-3 fst-italic">*Progress simulated/saved per session (or via backend if fully connected).</p>
                     </div>
                    <div class="modal-footer">
                         <!-- Reset Tasks Button (Maybe) -->
                         <!-- <button type="button" class="btn btn-warning btn-sm" id="resetLocalTasksBtn">Reset My Tasks</button> -->
                        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

         <!-- AI Judge Modal / Team Viewer -->
         <div class="modal fade" id="aiJudgeModal" tabindex="-1" aria-labelledby="aiJudgeModalLabel" aria-hidden="true">
             <div class="modal-dialog modal-xl modal-dialog-scrollable"> <!-- Wider Modal -->
                 <div class="modal-content">
                     <div class="modal-header">
                         <!-- Updated Title -->
                         <h5 class="modal-title" id="aiJudgeModalLabel"><i class="fas fa-users-cog me-2"></i>Teams & AI Judge Simulation</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <p class="text-muted small">View all qualified teams and their simulated scores. Select a team and click Judge for a *simulated* analysis (Admin view allows judging any team).</p>

                        <!-- Judge Simulation Area -->
                         <div class="border rounded p-3 mb-3 bg-light" id="judge-simulation-panel">
                             <div class="row g-2 align-items-end">
                                 <div class="col-sm-8">
                                     <label for="judgeTeamSelect" class="form-label small fw-bold">Select Team for Judging:</label>
                                     <select class="form-select form-select-sm" id="judgeTeamSelect">
                                         <option selected disabled value="">-- Choose Team --</option>
                                         <!-- Populated by JS -->
                                     </select>
                                 </div>
                                 <div class="col-sm-4">
                                     <button class="btn btn-primary w-100 btn-sm" type="button" id="judgeProjectBtn">
                                         <i class="fas fa-play me-1"></i> Judge (Sim)
                                     </button>
                                 </div>
                             </div>
                             <div id="judgeLoader" class="mt-2"> <div class="spinner-border spinner-border-sm text-primary" role="status"> <span class="visually-hidden">Loading...</span> </div> <p class="small d-inline ms-2">AI analyzing...</p> </div>
                             <div id="judgeResultsArea" class="mt-2">
                                 <h5 id="judgeResultTeamName" class="small mb-1"></h5>
                                 <div id="judgeResultAnalysis">
                                     <h6 class="small mb-1">Analysis:</h6>
                                     <ul id="judgeResultAnalysisList" class="small list-unstyled mb-2"></ul>
                                 </div>
                                 <div id="judgeResultScore"></div>
                             </div>
                             <p class="mb-0 small text-muted fst-italic mt-2"> <i class="fas fa-info-circle me-1"></i> Simulation only. Score based on progress/mock data. </p>
                         </div>

                         <hr class="my-4">

                         <!-- Groups/Leaderboard Area -->
                         <div id="groupsLeaderboardSection">
                              <h5 class="text-center mb-3"><i class="fas fa-trophy me-2" style="color: var(--primary-color);"></i>Qualified Teams & Simulated Scores</h5>
                             <div id="ai-leaderboard-loading" class="text-center text-muted small py-3"><div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> Loading Teams...</div>
                             <div id="ai-leaderboard-empty" style="display: none;" class="text-center text-muted small py-3">No qualified teams found.</div>
                             <div class="table-responsive">
                                  <table class="table table-striped table-hover table-sm align-middle small" id="aiLeaderboardTable" style="display: none;">
                                     <thead class="table-dark small">
                                         <tr>
                                              <th scope="col" style="width: 10%; text-align: center;">Rank</th>
                                             <th scope="col" style="width: 25%;">Team Name</th>
                                              <th scope="col" style="width: 45%;">Members (Lead <span class="leader-emoji">‚≠ê</span>)</th> <!-- Updated -->
                                              <th scope="col" style="width: 20%;">University / Org</th> <!-- Added -->
                                              <th scope="col" style="width: 10%; text-align: center;">Score</th>
                                          </tr>
                                     </thead>
                                     <tbody id="ai-leaderboard-body"></tbody>
                                 </table>
                             </div>
                         </div>

                     </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button> </div> </div> </div>
        </div>

         <!-- Registration Modal - Keep Structure but hide trigger button -->
         <div class="modal fade" id="registrationModal" tabindex="-1" aria-labelledby="registrationModalLabel" aria-hidden="true">
             <div class="modal-dialog modal-lg modal-dialog-scrollable">
                 <div class="modal-content">
                     <div class="modal-header">
                          <h5 class="modal-title" id="registrationModalLabel"><i class="fas fa-id-card me-2"></i>Registration Details (View Only)</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                         <!-- Content would be populated if needed for profile update later -->
                          <p class="text-center text-muted">Team registration is closed. View your team details in the Profile modal (<i class="fas fa-user-circle"></i> top right).</p>
                         <form id="registrationForm" style="display:none;"> <!-- Hide form -->
                             </form>
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                          <!-- Hide confirm button -->
                          <button type="button" class="btn btn-primary btn-sm" id="submitRegistrationBtn" style="display: none;">
                             Confirm Registration / Join
                         </button>
                     </div>
                 </div>
             </div>
         </div>

        <!-- Profile Modal -->
        <div class="modal fade" id="userProfileModal" tabindex="-1" aria-labelledby="userProfileModalLabel" aria-hidden="true">
             <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                 <div class="modal-content">
                     <div class="modal-header">
                         <h5 class="modal-title" id="userProfileModalLabel">Your Profile & Progress</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                         <div id="modal-user-avatar">üë§</div>
                         <h4 id="modal-user-name">Player Name</h4>
                          <!-- Added Team Name Display -->
                         <div id="profile-team-display" class="text-muted small">Team: Loading...</div>
                         <div id="modal-welly-points-display">
                              <i class="fas fa-star"></i> <span id="modal-welly-points">0</span> WP
                          </div>
                          <hr class="my-2">
                          <!-- Detailed Team Info -->
                         <div id="profile-team-details-section">
                             <h5><i class="fas fa-users me-2"></i>Your Team</h5>
                             <ul id="profile-team-members-display" class="text-center small">
                                 <li>Loading members...</li>
                             </ul>
                         </div>
                          <hr class="my-3">
                         <div id="profile-rank-display">Rank: Loading...</div>
                         <hr class.my-3">
                         <div id="profile-leaderboard-section">
                             <h5><i class="fas fa-trophy me-2" style="color: var(--primary-color);"></i>Points Leaderboard (Top 5 Players)</h5>
                              <div id="leaderboard-loading" class="text-center text-muted small py-3"><div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> Loading Leaderboard...</div>
                              <div id="leaderboard-empty" style="display: none;">Leaderboard is empty.</div>
                             <div class="table-responsive">
                                  <table class="table table-striped table-hover table-sm caption-top" id="profile-leaderboard-table" style="display: none;">
                                     <thead><tr><th scope="col" style="width: 15%; text-align: center;">Rank</th><th scope="col">Player</th><th scope="col" style="width: 30%; text-align: right;">Points</th></tr></thead>
                                     <tbody id="profile-leaderboard-body"></tbody>
                                 </table>
                             </div>
                         </div>
                     </div>
                     <div class="modal-footer justify-content-between align-items-center">
                         <div style="flex-grow: 1; text-align: left;">
                              <!-- Reset Button - Check Admin status before enabling full reset? -->
                             <button type="button" class="btn btn-danger btn-sm" id="reset-progress-btn">
                                  <i class="fas fa-trash-alt me-1"></i> Reset My Points/Tasks
                             </button>
                             <div id="reset-feedback" class="small d-block mt-1"></div>
                         </div>
                         <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                     </div>
                 </div>
             </div>
        </div>

        <!-- Flying Score Element -->
        <div id="flying-score-element"></div>

        <!-- Bottom Navigation (Managed by JS) -->
        <nav class="bottom-nav" aria-label="Mobile navigation">
             <div class="d-flex justify-content-around w-100">
                 <a href="#" target="_self" class="btn"><i class="fas fa-home"></i>Home</a>
                 <a href="#" target="_self" class="btn"><i class="fas fa-book"></i>LMS</a>
                 <a href="#" target="_self" class="btn"><i class="fas fa-puzzle-piece"></i>Quest</a>
                 <a href="#" target="_self" class="btn active"><i class="fas fa-laptop-code"></i>Hackathon</a>
             </div>
         </nav>

    </div> <!-- End #main-app-content -->

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Login & App Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const MAX_TEAM_MEMBERS = 5; // Increased based on data for Bitwise team
            const API_BASE_URL = 'http://localhost:3000/api'; // Example for local testing

            // --- Element References ---
            const loadingOverlay = document.getElementById('loading-overlay');
            const logo = document.getElementById('header-logo');
            const bodyElement = document.body;
             const mainAppContent = document.getElementById('main-app-content'); // Wrapper for main content
             const loginModalElement = document.getElementById('loginModal');
             const loginPhoneInput = document.getElementById('loginPhoneInput');
             const adminPasswordGroup = document.getElementById('adminPasswordGroup');
             const adminPasswordInput = document.getElementById('adminPasswordInput');
             const loginSubmitBtn = document.getElementById('loginSubmitBtn');
             const loginFeedback = document.getElementById('loginFeedback');
            const userProfileElement = document.getElementById('user-profile'); // Top-right display
            const userNameDisplay = document.getElementById('user-name-display');
            const userTeamDisplay = document.getElementById('user-profile-team-name'); // Added for top-right
            const wellyPointsDisplay = document.getElementById('welly-points');
            const userAvatarContainer = document.getElementById('user-avatar');
             const bottomNav = document.querySelector('.bottom-nav'); // Select the nav bar
             const floatingButtons = document.querySelectorAll('.floating-button'); // Select all floating buttons

             // Content sections
             const taskTrackerBtn = document.getElementById('task-tracker-btn');
             const aiJudgeBtn = document.getElementById('ai-judge-btn');
            const modalChecklist = document.getElementById('modal-checklist');
            const messageArea = document.getElementById('task-message-area');
            const progressBar = document.querySelector('#progress .progress-bar');
            const taskModalElement = document.getElementById('taskTrackerModal');
            const judgeModalElement = document.getElementById('aiJudgeModal');
             const judgeSimPanel = document.getElementById('judge-simulation-panel'); // Panel containing judge controls
            const judgeTeamSelect = document.getElementById('judgeTeamSelect');
            const judgeProjectBtn = document.getElementById('judgeProjectBtn');
            const judgeLoader = document.getElementById('judgeLoader');
            const judgeResultsArea = document.getElementById('judgeResultsArea');
            const judgeResultTeamName = document.getElementById('judgeResultTeamName');
            const judgeResultAnalysisList = document.getElementById('judgeResultAnalysisList');
            const judgeResultScore = document.getElementById('judgeResultScore');
            const aiLeaderboardSection = document.getElementById('groupsLeaderboardSection');
            const aiLeaderboardTable = document.getElementById('aiLeaderboardTable');
            const aiLeaderboardBody = document.getElementById('ai-leaderboard-body');
            const aiLeaderboardLoading = document.getElementById('ai-leaderboard-loading');
            const aiLeaderboardEmpty = document.getElementById('ai-leaderboard-empty');
            const flyingScoreElement = document.getElementById('flying-score-element');

             // Registration elements (mostly unused now)
             const registrationModalElement = document.getElementById('registrationModal'); // Kept for potential view/update profile

            // Profile Modal Elements
            const profileModalElement = document.getElementById('userProfileModal');
            const modalUserAvatar = document.getElementById('modal-user-avatar');
            const modalUserName = document.getElementById('modal-user-name');
             const modalProfileTeamDisplay = document.getElementById('profile-team-display'); // Inside profile modal
            const modalWellyPoints = document.getElementById('modal-welly-points');
             const profileTeamMembersDisplay = document.getElementById('profile-team-members-display'); // Added
            const profileRankDisplay = document.getElementById('profile-rank-display');
             //const profileTeamDisplay = document.getElementById('profile-team-display'); // Already declared for modal
            const profileLeaderboardSection = document.getElementById('profile-leaderboard-section');
            const profileLeaderboardTable = document.getElementById('profile-leaderboard-table');
            const profileLeaderboardTableBody = document.getElementById('profile-leaderboard-body');
            const profileLeaderboardLoading = document.getElementById('leaderboard-loading');
            const profileLeaderboardEmpty = document.getElementById('leaderboard-empty');
            const resetProgressBtn = document.getElementById('reset-progress-btn');
            const resetFeedbackArea = document.getElementById('reset-feedback');

            // --- State Variables ---
            let isLoggedIn = false;
             let isAdmin = false;
             // Use structured team data for logged-in user & simulation
            let currentUserData = { id: null, name: 'Player', points: 0, registeredTeamName: null, tasks: {}, isAdmin: false, teamEmoji: '‚ùì', leaderEmoji: '' };
            let allTeamsData = {}; // Holds data for ALL teams (fetched by admin or for display)
            let pointsLeaderboardData = [];

            // --- Hardcoded Qualified Teams Data (for Demo) ---
            // Normalize phone numbers immediately
             const normalizePhone = (phone) => {
                 if (!phone) return null;
                 // Remove all non-digit characters except '+' at the start
                 let normalized = phone.toString().replace(/[^\d+]/g, '');
                 if (normalized.startsWith('00971')) {
                     normalized = '+' + normalized.substring(2);
                 } else if (normalized.startsWith('05')) { // Common UAE mobile format without country code
                      normalized = '+971' + normalized.substring(1);
                  } else if (normalized.startsWith('5')) { // Sometimes entered without leading 0
                      normalized = '+971' + normalized;
                  }
                 // Ensure + exists if 971 is present
                 if (normalized.startsWith('971')) {
                     normalized = '+' + normalized;
                 }
                 return normalized;
             };

             // Emoji Assignment (Example)
             const teamEmojis = ['ü§ñ', 'üöÄ', 'üí°', 'üíª', '‚ö°', '‚õìÔ∏è', 'üìä', 'üìà', 'üß†', 'ü¶â'];
             let emojiIndex = 0;

             // Manually define the 10 QUALIFIED teams
             const qualifiedTeamsData = new Map([
                 ['AI hackers', { leadName: 'Rushirajsinh Solanki', phone: normalizePhone('+971 52 349 2003'), members: ['Rushirajsinh Solanki', 'Arya Pai kane', 'Pawan Bhansari', 'Manavkrishna Manoj'], university: 'BITS Pilani Dubai Campus', skills: 'Python, TF, PyTorch, ML, DL', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }],
                 ['Unnamed_Team_Veron', { leadName: 'Veron Monteiro', phone: normalizePhone('+971 56 366 8911'), members: ['Veron Monteiro', 'Chris Rowan D Souza', 'Iffah Konian', 'Asma Mohammad Afzal', 'Mohamed Maahir'], university: 'Manipal Academy of Higher Education, Dubai', skills: 'Python, JS, TS, React, NextJS', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }], // Assuming Veron is lead
                 ['Tech Titans', { leadName: 'Harsh Garg', phone: normalizePhone('+971 557339452'), members: ['Harsh Garg', 'Sanober Sarfaraz', 'Siddharath Malavalli', 'Tanay Matta'], university: 'BITS Pilani Dubai Campus', skills: 'HTML, CSS, JS, React, Python, AI/ML', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }],
                 ['Bitwise', { leadName: 'Shambhavi Anand', phone: normalizePhone('0581249796'), members: ['Shambhavi Anand', 'Rachael Gomes', 'Fida Akhunji', 'Fathma Sada Jamaludeen', 'Shayaan Mohamed Sufiyan Gaima'], university: 'MAHE Dubai', skills: 'Python, C, C++, SQL, Flutter, AI', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }], // 5 Members
                 ['TeamSquare', { leadName: 'Mohammad Muhsin', phone: normalizePhone('+971 56 609 5178'), members: ['Mohammad Muhsin', 'Aeman Babar', 'Britney Bjiu', 'Gouri Anil'], university: 'Amity University Dubai', skills: 'Python, HTML, CSS, JS, PHP, ML', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }],
                 ['AlgoRhythm', { leadName: 'Lena Mary Raino', phone: normalizePhone('+971 505958386'), members: ['Lena Mary Raino', 'Aysha Abdul Hakeem', 'Haya Saleem', 'Sofia Arwen Lacap'], university: 'Amity University Dubai', skills: 'C, Java, HTML, Design Tools', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }], // Check second entry +971 55 945 7179 - using first one listed.
                 ['AmityTech', { leadName: 'Anish Prabu', phone: normalizePhone('+971 54 744 5587'), members: ['Anish Prabu', 'Anchan Sunil', 'Megan Pinto', 'Benson Sebastian'], university: 'Amity University Dubai', skills: 'Python, JS, HTML, Java, C++, MySQL', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }], // Use first entry's phone.
                 ['Chain GPT', { leadName: 'Vaibhav Shrestha', phone: normalizePhone('+971526973416'), members: ['Vaibhav Shrestha', 'Aadish Jain', 'Aditya Singhal', 'Adit Tiwari'], university: 'BITS Pilani Dubai Campus', skills: 'Python, C, Java, Web Dev, UI/UX', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }], // Duplicate name, use qualified team name context. Phone matches both his entries.
                 ['ThunderBolts', { leadName: 'Akash Rajasekar', phone: normalizePhone('+971 565246823'), members: ['Akash Rajasekar', 'Aaryan Sinha', 'Laya Shree Elango', 'Ilfa Shaheed Valiyavallappil', 'Angela Arul'], university: 'BITS Pilani, Dubai Campus', skills: 'Python, MERN, Llama, Flask', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }],
                 ['Unnamed_Team_Ali', { leadName: 'Ali Abed', phone: normalizePhone('971 545965158'), members: ['Ali Abed', 'Murtaza', 'Rahat', 'Sakib'], university: 'Amity University Dubai', skills: 'Python, MySQL, Java, C', emoji: teamEmojis[emojiIndex++], leaderEmoji: '‚≠ê' }]
             ]);

            // Create a lookup for ANY member (using lead's phone primarily for this demo)
            // A real app needs a proper user database mapping phone/email to user ID and team
            const participantLookup = new Map();
            qualifiedTeamsData.forEach((teamData, teamName) => {
                if (teamData.phone) {
                    participantLookup.set(teamData.phone, {
                         teamName: teamName,
                         userName: teamData.leadName,
                         isLead: true,
                         userId: teamData.phone // Use phone as unique ID for demo
                    });
                }
                // TODO: Ideally parse and add other members' contact info if reliable
                // This part is complex due to the messy format of the initial data dump.
                // Example: Manually adding another member if info was clean
                // const normalizedMemberPhone = normalizePhone('MEMBER_PHONE_HERE');
                // if (normalizedMemberPhone) {
                //      participantLookup.set(normalizedMemberPhone, {
                //         teamName: teamName,
                //         userName: 'Member Name',
                //         isLead: false,
                //         userId: normalizedMemberPhone
                //      });
                // }
            });

            const ADMIN_USERNAME = 'admin'; // Use username for admin login simplicity
             const ADMIN_PASSWORD = 'admin'; // INSECURE! Only for demo.

            // --- Helper Functions (Mostly unchanged, some additions) ---
            function showLoading(message = "Loading...") { if (loadingOverlay) { loadingOverlay.querySelector('p').textContent = message; loadingOverlay.classList.add('show'); } }
            function hideLoading() { if (loadingOverlay) loadingOverlay.classList.remove('show'); }
            function showMessage(message, type = 'success', area = messageArea, clearPrevious = true) { if (area) { if (clearPrevious) area.innerHTML = ''; const alertDiv = document.createElement('div'); alertDiv.className = `alert alert-${type} alert-dismissible fade show small p-2`; alertDiv.setAttribute('role', 'alert'); alertDiv.innerHTML = `${message}<button type="button" class="btn-close btn-sm p-2" data-bs-dismiss="alert" aria-label="Close"></button>`; area.appendChild(alertDiv); } }
            function clearMessages(area = messageArea) { if (area) area.innerHTML = ''; }
            function showPointsGainAnimation(points) { if (!userProfileElement || points <= 0) return; const gainElement = document.createElement('div'); gainElement.textContent = `+${points} WP`; gainElement.className = 'welly-points-gain'; document.body.appendChild(gainElement); const profileRect = userProfileElement.getBoundingClientRect(); const startX = profileRect.left + profileRect.width / 2; const startY = profileRect.bottom + 10; gainElement.style.left = `${startX}px`; gainElement.style.top = `${startY}px`; gainElement.style.opacity = '0'; gainElement.style.transform = 'translateX(-50%) scale(0.8)'; requestAnimationFrame(() => { gainElement.style.top = `${startY - 40}px`; gainElement.style.opacity = '1'; gainElement.style.transform = 'translateX(-50%) scale(1)'; }); setTimeout(() => { gainElement.style.opacity = '0'; gainElement.style.transform = 'translateX(-50%) scale(0.8)'; setTimeout(() => gainElement.remove(), 800); }, 1000); }
            function setupLogoScroll() { if (logo) { const handleScroll = () => { const isScrolled = window.scrollY > 30; logo.classList.toggle('logo-scrolled', isScrolled); bodyElement.classList.toggle('logo-state-scrolled', isScrolled); }; logo.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); }); window.addEventListener('scroll', handleScroll, { passive: true }); handleScroll(); } }

            // --- API Interaction Functions (Simulated/Adapted) ---
            // Simulate fetching data based on logged-in user
            async function apiFetchDataForUser() {
                 if (isAdmin) {
                    await apiFetchAdminData(); // Fetch all data for admin
                } else if (currentUserData.id && currentUserData.registeredTeamName) {
                    await apiFetchInitialData(); // Fetch user-specific data
                 } else {
                    console.error("Cannot fetch data: User not properly logged in.");
                    hideLoading();
                }
            }

            // Simulates fetching USER-SPECIFIC data
            async function apiFetchInitialData() {
                 showLoading("Loading Your Data...");
                 console.log("Simulating fetch for user:", currentUserData.id, "Team:", currentUserData.registeredTeamName);
                 try {
                     // Simulate API call - replace with actual fetch if backend is ready
                     await new Promise(resolve => setTimeout(resolve, 500)); // Fake delay

                     // In a real scenario, fetch `/api/initial-data` with auth header
                     // The backend returns data scoped to this user { user: {...}, team: {...}, leaderboard: [...] }

                     // --- SIMULATION ---
                     // Get team data from our hardcoded map
                     const teamData = qualifiedTeamsData.get(currentUserData.registeredTeamName);
                     const mockTeamInfo = teamData ? { score: Math.random() * 7 + 3, ...teamData } : {}; // Add random score for simulation

                    // Use stored or default values for user data (points/tasks would come from backend)
                    // For this demo, tasks and points start fresh unless stored in localStorage maybe?

                     // Generate mock leaderboard focusing on points
                     pointsLeaderboardData = Array.from(participantLookup.values()).map(p => ({
                          id: p.userId,
                          name: p.userName,
                          points: Math.floor(Math.random() * 150) // Random points for demo
                     })).sort((a, b) => b.points - a.points);

                    // Mock fetching team scores (needed for Judge modal)
                     allTeamsData = {}; // Reset
                     qualifiedTeamsData.forEach((tData, tName) => {
                          allTeamsData[tName] = {
                               members: tData.members || [],
                              university: tData.university || 'N/A',
                              score: parseFloat((Math.random() * 7 + 3).toFixed(1)), // Random score for each team
                               emoji: tData.emoji,
                              leadName: tData.leadName,
                              leaderEmoji: tData.leaderEmoji
                          };
                      });


                     console.log("Simulated initial data loaded for user:", currentUserData.id);
                     // Update UI
                     updateUserProfileDisplay();
                     initializeTaskUI(); // Will be empty initially or use localStorage if added
                     updateProgressBar();
                      updateAiJudgeModal(); // Show teams based on allTeamsData
                      displayPointsLeaderboard(); // Show points leaderboard

                 } catch (error) {
                     console.error("Failed to fetch/simulate initial data:", error);
                     alert(`Error loading data: ${error.message}. Please try logging in again.`);
                     // Handle error - potentially force logout
                      logout();
                 } finally {
                     hideLoading();
                 }
            }

             // Simulates fetching ALL team data for ADMIN
            async function apiFetchAdminData() {
                 showLoading("Loading All Team Data (Admin)...");
                 console.log("Simulating fetch for ADMIN");
                 try {
                     // Simulate API call - replace with actual fetch to `/api/admin/all-data`
                     await new Promise(resolve => setTimeout(resolve, 700)); // Fake delay

                     // --- SIMULATION ---
                     // Generate mock data for all teams, including scores and maybe task progress overview if needed
                      allTeamsData = {};
                      qualifiedTeamsData.forEach((tData, tName) => {
                           allTeamsData[tName] = {
                               members: tData.members || [],
                               university: tData.university || 'N/A',
                               score: parseFloat((Math.random() * 7 + 3).toFixed(1)), // Assign random score
                               emoji: tData.emoji,
                               leadName: tData.leadName,
                               leaderEmoji: tData.leaderEmoji
                               // Could add aggregated task progress here if needed for admin view
                           };
                      });

                     // Mock points leaderboard remains the same
                     pointsLeaderboardData = Array.from(participantLookup.values()).map(p => ({
                          id: p.userId,
                          name: p.userName,
                           points: Math.floor(Math.random() * 150) // Random points for demo
                     })).sort((a, b) => b.points - a.points);


                     console.log("Simulated data loaded for admin");
                     // Update UI
                      updateUserProfileDisplay(); // Show "Admin User" etc.
                     initializeTaskUI(); // Might be empty or show aggregated view
                      updateProgressBar(); // Maybe show overall progress?
                     updateAiJudgeModal(); // Crucial: Show all teams
                     displayPointsLeaderboard(); // Show leaderboard

                 } catch (error) {
                     console.error("Failed to fetch/simulate admin data:", error);
                     alert(`Error loading admin data: ${error.message}.`);
                     logout();
                 } finally {
                     hideLoading();
                 }
             }


            // Simulates completing a task (needs Auth in real backend)
             async function apiCompleteTask(taskId, pointsToAdd) {
                 if (!isLoggedIn || isAdmin) {
                    console.warn("Task completion ignored. Not logged in or is admin.");
                     return Promise.reject(new Error("Action not allowed.")); // Simulate rejection
                 }
                showLoading("Saving Task...");
                 console.log(`Simulating complete task ${taskId} for user ${currentUserData.id}`);
                 try {
                      await new Promise(resolve => setTimeout(resolve, 300)); // Fake delay
                     // Simulate backend update: adds points, marks task done
                     currentUserData.points = (currentUserData.points || 0) + pointsToAdd;
                     currentUserData.tasks[taskId] = true;
                     const result = { success: true, newTotalPoints: currentUserData.points };
                     // TODO: Could add localStorage persistence here for demo
                     return result;
                 } catch (error) {
                    console.error(`API Error completing task ${taskId}:`, error);
                    // Revert local state (or reload from localStorage if used)
                    currentUserData.tasks[taskId] = false; // Mark as not completed locally
                    updateTaskUI(taskId, false); // Update UI back
                    throw error;
                 } finally {
                     hideLoading();
                 }
             }

             // Simulates judging a team (needs Auth)
             async function apiJudgeTeam(teamName) {
                 if (!isLoggedIn) return Promise.reject(new Error("Not logged in"));
                  // Allow admin to judge any team, regular user maybe only views?
                  // For demo, let anyone trigger the *simulation*.
                 showLoading(`Judging ${teamName}...`);
                 console.log(`Simulating judge team ${teamName} by user ${currentUserData.id}`);
                 try {
                     await new Promise(resolve => setTimeout(resolve, 1200)); // Longer fake delay for "AI"
                      // --- SIMULATION ---
                     const teamExists = allTeamsData[teamName];
                      if (!teamExists) throw new Error("Team not found for judging.");

                     // Generate a new random score and analysis points
                     const newScore = parseFloat((Math.random() * 8 + 2).toFixed(1)); // Score between 2.0 and 10.0
                     const analysisPoints = [
                          "Reviewed core logic structure.",
                          `Data generation confirmed for ${teamName}.`,
                          "Innovation factor assessed (simulated).",
                           `Impact potential estimated at ${(newScore / 10 * 100).toFixed(0)}%.`,
                           "Overall Feasibility: " + (newScore > 6 ? "Good" : newScore > 4 ? "Fair" : "Needs Review"),
                       ];
                      const result = { score: newScore, analysis: analysisPoints };

                     // Update the local 'allTeamsData' cache with the new score
                      if (allTeamsData[teamName]) {
                           allTeamsData[teamName].score = result.score;
                      }
                       return result;
                 } catch (error) {
                    console.error(`API Error judging team ${teamName}:`, error);
                    throw error;
                 } finally {
                    hideLoading();
                 }
             }

            // Simulates resetting user data (needs Auth)
              async function apiResetUserData() {
                 if (!isLoggedIn || isAdmin) { // Prevent admin reset via this button for now
                     console.warn("Reset ignored. Not logged in or is admin.");
                     return Promise.reject(new Error("Action not allowed."));
                 }
                  showLoading("Resetting Your Data...");
                  console.log(`Simulating reset data for user ${currentUserData.id}`);
                  try {
                    await new Promise(resolve => setTimeout(resolve, 400)); // Fake delay
                     // Reset local state
                    currentUserData.points = 0;
                    currentUserData.tasks = {};
                     // Keep registeredTeamName, name, id etc.
                    const result = { success: true };
                     // TODO: Clear localStorage if used
                    return result;
                 } catch (error) {
                     console.error("API Error resetting user data:", error);
                    throw error;
                 } finally {
                    hideLoading();
                 }
              }

             // Fetch latest team data (simulated)
             async function apiGetTeams() {
                  if (!isLoggedIn) return Promise.reject({});
                  console.log("Simulating fetching all teams data...");
                   // Just return the cached data in this simulation
                   // In real app, fetch fresh data from backend
                  return Promise.resolve(allTeamsData);
             }

            // Fetch latest leaderboard (simulated)
             async function apiGetLeaderboard() {
                  if (!isLoggedIn) return Promise.reject([]);
                  console.log("Simulating fetching points leaderboard...");
                  // Return cached/mocked data
                   // In real app, fetch fresh data from backend
                  return Promise.resolve(pointsLeaderboardData);
             }

            // --- Login/Logout Logic ---
             function handleLogin() {
                 const enteredPhone = loginPhoneInput.value.trim();
                 const normalizedInput = normalizePhone(enteredPhone); // Normalize phone or keep as 'admin'
                 const feedback = (msg, type = 'danger') => { loginFeedback.textContent = msg; loginFeedback.className = `text-center mt-3 small feedback-${type}`; };
                 feedback('', 'info'); // Clear previous feedback
                 loginSubmitBtn.disabled = true;

                if (!enteredPhone) {
                     feedback("Please enter your phone number or 'admin'.");
                    loginSubmitBtn.disabled = false;
                    return;
                 }

                // Admin Login Check
                if (enteredPhone.toLowerCase() === ADMIN_USERNAME) {
                    adminPasswordGroup.style.display = 'block';
                     const enteredPassword = adminPasswordInput.value;
                    if (!enteredPassword) {
                        feedback("Please enter admin password.");
                        adminPasswordInput.focus();
                        loginSubmitBtn.disabled = false;
                        return;
                    }
                    if (enteredPassword === ADMIN_PASSWORD) {
                         // Admin Login Success
                         console.log("Admin login successful");
                        isAdmin = true;
                        isLoggedIn = true;
                        currentUserData = { id: 'admin', name: 'Admin', points: 0, registeredTeamName: null, tasks: {}, isAdmin: true, teamEmoji: 'üëë', leaderEmoji: 'üëë' };
                        loginSuccess();
                    } else {
                         feedback("Incorrect admin password.");
                        adminPasswordInput.value = '';
                        loginSubmitBtn.disabled = false;
                    }
                }
                 // Participant Login Check
                else if (participantLookup.has(normalizedInput)) {
                     const participantInfo = participantLookup.get(normalizedInput);
                     console.log("Participant login successful:", participantInfo.userName, "Team:", participantInfo.teamName);
                     isAdmin = false;
                     isLoggedIn = true;
                     const teamData = qualifiedTeamsData.get(participantInfo.teamName);
                     currentUserData = {
                          id: participantInfo.userId, // Use stored ID
                          name: participantInfo.userName,
                          points: 0, // Load from backend/localStorage later
                          registeredTeamName: participantInfo.teamName,
                          tasks: {}, // Load from backend/localStorage later
                          isAdmin: false,
                         teamEmoji: teamData?.emoji || '‚ùì', // Get team emoji
                         leaderEmoji: participantInfo.isLead ? (teamData?.leaderEmoji || '‚≠ê') : '' // Leader emoji only for lead
                      };
                     loginSuccess();
                 } else {
                    // Login Failed
                    feedback("Phone number not found in qualified teams or invalid admin login.");
                     adminPasswordGroup.style.display = 'none'; // Hide password field if shown
                     adminPasswordInput.value = '';
                     loginSubmitBtn.disabled = false;
                 }
            }

             function loginSuccess() {
                 const loginModal = bootstrap.Modal.getInstance(loginModalElement);
                 if (loginModal) {
                     loginModal.hide();
                 }
                 loginModalElement.addEventListener('hidden.bs.modal', () => {
                      // Show main app content AFTER modal is hidden
                      mainAppContent.style.display = 'block';
                      userProfileElement.style.display = 'flex';
                     bottomNav.style.display = 'flex';
                     floatingButtons.forEach(btn => btn.style.display = 'flex');

                      // Fetch data based on user role
                      apiFetchDataForUser();
                       setupLogoScroll(); // Setup scroll effects now
                 }, { once: true });
             }

             function logout() {
                // Basic logout simulation: Reload the page
                console.log("Logging out...");
                 window.location.reload();
                // More sophisticated logout would clear state, hide main content, show login modal
                // isLoggedIn = false;
                // isAdmin = false;
                // currentUserData = { ... }; // Reset user data
                // mainAppContent.style.display = 'none';
                 // userProfileElement.style.display = 'none';
                // bootstrap.Modal.getOrCreateInstance(loginModalElement).show();
             }

            // --- UI Update Functions ---
             function updateUserProfileDisplay() {
                 const displayName = currentUserData.name || 'Player';
                 const currentPoints = currentUserData.points || 0;
                 const teamName = currentUserData.registeredTeamName || (isAdmin ? 'Admin View' : 'No Team');
                 const userEmoji = currentUserData.teamEmoji || 'üë§'; // Use team emoji or default

                 if (userNameDisplay) userNameDisplay.textContent = displayName;
                 if (userTeamDisplay) userTeamDisplay.textContent = isAdmin ? '' : `(${teamName})`; // Show team in top bar
                 if (userAvatarContainer) userAvatarContainer.innerHTML = userEmoji; // Use assigned emoji
                 if (wellyPointsDisplay) wellyPointsDisplay.textContent = currentPoints;
                 if (userProfileElement) userProfileElement.style.display = 'flex'; // Ensure visible

                // Update Profile Modal
                 if (modalUserName) modalUserName.textContent = displayName;
                 if (modalUserAvatar) modalUserAvatar.innerHTML = userEmoji;
                 if (modalWellyPoints) modalWellyPoints.textContent = currentPoints;
                 if (modalProfileTeamDisplay) modalProfileTeamDisplay.textContent = `Team: ${teamName}`; // Show in profile modal body
                 if (profileTeamMembersDisplay) updateProfileTeamMembers(); // Populate team member list
                 if (profileRankDisplay) profileRankDisplay.textContent = "Rank: Loading...";

                // Disable features for Admin if needed
                 if (isAdmin) {
                      if (taskTrackerBtn) taskTrackerBtn.style.display = 'none'; // Hide task tracker for admin
                      if (resetProgressBtn) resetProgressBtn.disabled = true; // Disable reset for admin
                      if (wellyPointsDisplay) wellyPointsDisplay.closest('div').style.display = 'none'; // Hide points for admin? Or show total?
                 } else {
                      if (taskTrackerBtn) taskTrackerBtn.style.display = 'flex';
                     if (resetProgressBtn) resetProgressBtn.disabled = false;
                      if (wellyPointsDisplay) wellyPointsDisplay.closest('div').style.display = 'inline';
                  }
             }

             // New function to update team members in profile modal
             function updateProfileTeamMembers() {
                if (!profileTeamMembersDisplay) return;
                profileTeamMembersDisplay.innerHTML = ''; // Clear previous

                if (currentUserData.registeredTeamName && allTeamsData[currentUserData.registeredTeamName]) {
                    const team = allTeamsData[currentUserData.registeredTeamName];
                    if (team.members && team.members.length > 0) {
                         team.members.forEach(memberName => {
                             const li = document.createElement('li');
                              const isLead = memberName === team.leadName;
                              const isCurrentUser = memberName === currentUserData.name;
                              let memberHtml = `${memberName}`;
                              if (isLead) memberHtml += ` <span class="leader-emoji">${team.leaderEmoji || '‚≠ê'}</span>`;
                              if (isCurrentUser) memberHtml += ` <span class="badge bg-success">You</span>`;
                              li.innerHTML = memberHtml;
                              profileTeamMembersDisplay.appendChild(li);
                          });
                    } else {
                        profileTeamMembersDisplay.innerHTML = '<li>No member data available.</li>';
                     }
                } else if (!isAdmin) {
                     profileTeamMembersDisplay.innerHTML = '<li>Not currently in a team.</li>';
                } else {
                     profileTeamMembersDisplay.innerHTML = '<li>Admin view - select team below.</li>';
                 }
             }


            function initializeTaskUI() { // Unchanged logic, depends on currentUserData.tasks
                 if (!modalChecklist || isAdmin) return; // Skip for admin
                modalChecklist.querySelectorAll('.checklist-item[data-task-id]').forEach(item => {
                     const taskId = item.dataset.taskId;
                     updateTaskUI(taskId, currentUserData.tasks[taskId] === true);
                 });
            }
            function updateTaskUI(taskId, isCompleted) { // Unchanged
                 const modalItem = modalChecklist?.querySelector(`.checklist-item[data-task-id="${taskId}"]`); if (modalItem) { modalItem.classList.toggle('completed', isCompleted); modalItem.style.cursor = isCompleted ? 'default' : 'pointer'; }
            }

             function updateProgressBar() { // Unchanged logic, depends on currentUserData.tasks
                 if (!modalChecklist || !progressBar || isAdmin) { // Skip for admin or hide?
                     if (progressBar) progressBar.style.width = '0%'; progressBar.textContent = isAdmin ? 'N/A (Admin)' : '0%';
                     return;
                  };
                 const taskItems = modalChecklist.querySelectorAll('.checklist-item[data-task-id]');
                 const totalTasks = taskItems.length;
                 const completedTasks = Object.values(currentUserData.tasks || {}).filter(status => status === true).length;
                 const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                 progressBar.style.width = progressPercent + '%'; progressBar.textContent = `${progressPercent}%`; progressBar.setAttribute('aria-valuenow', progressPercent); progressBar.classList.toggle('bg-success', progressPercent === 100); progressBar.classList.toggle('progress-bar-animated', progressPercent < 100); progressBar.classList.toggle('progress-bar-striped', progressPercent < 100);
             }

             // --- Task Click Handler ---
            if (modalChecklist) {
                modalChecklist.addEventListener('click', async function(event) {
                    if (isAdmin) return; // Admin cannot complete tasks this way

                     const taskItem = event.target.closest('.checklist-item[data-task-id]');
                    if (!taskItem || taskItem.classList.contains('completed') || !currentUserData.id) {
                        return;
                     }

                     const taskId = taskItem.dataset.taskId;
                     const taskNameElement = taskItem.querySelector('strong');
                     const taskName = taskNameElement ? taskNameElement.textContent.trim() : `Task ${taskId}`;
                     const pointsToAdd = parseInt(taskItem.dataset.points || '0', 10);
                     clearMessages();

                     if (confirm(`Mark "${taskName}" as complete and claim ${pointsToAdd} WP?`)) {
                          taskItem.style.pointerEvents = 'none'; taskItem.style.opacity = '0.7';
                          try {
                              const result = await apiCompleteTask(taskId, pointsToAdd);
                              updateTaskUI(taskId, true);
                              updateProgressBar();
                              updateUserProfileDisplay();
                              showPointsGainAnimation(pointsToAdd);
                              showMessage(`Task "${taskName}" complete! +${pointsToAdd} WP earned. <span class="celebration-emoji">${taskItem.querySelector('.celebration-emoji')?.textContent || '‚úÖ'}</span>`, 'success');
                              apiGetLeaderboard().then(displayPointsLeaderboard).catch(console.error); // Refresh leaderboard view
                          } catch (error) {
                              console.error(`Failed to complete task ${taskId}:`, error);
                              showMessage(`Error completing task: ${error.message || 'Please try again.'}`, 'danger');
                          } finally {
                              taskItem.style.pointerEvents = 'auto'; taskItem.style.opacity = '1';
                          }
                     }
                 });
            }
             if (taskModalElement) taskModalElement.addEventListener('hidden.bs.modal', () => clearMessages());

            // --- AI Judge & Team Viewer Logic ---
             async function updateAiJudgeModal() { // Make async to fetch teams if needed
                if (!judgeTeamSelect || !aiLeaderboardBody || !aiLeaderboardLoading || !aiLeaderboardEmpty || !aiLeaderboardTable) return;

                 aiLeaderboardLoading.style.display = 'block';
                 aiLeaderboardTable.style.display = 'none';
                 aiLeaderboardEmpty.style.display = 'none';
                 aiLeaderboardBody.innerHTML = '';
                 const judgeDropdownCurrentValue = judgeTeamSelect.value;
                 judgeTeamSelect.innerHTML = '<option selected disabled value="">-- Choose Team --</option>';

                try {
                    // Fetch or use cached allTeamsData
                     const teamsToDisplay = await apiGetTeams(); // Simulates fetch or gets cache

                     const teamsArray = Object.entries(teamsToDisplay)
                         .map(([name, data]) => ({ name, ...data }))
                         .sort((a, b) => (b.score || 0) - (a.score || 0)); // Sort by score DESC

                    if (teamsArray.length === 0) {
                         aiLeaderboardEmpty.textContent = 'No qualified teams found.';
                        aiLeaderboardEmpty.style.display = 'block';
                     } else {
                        aiLeaderboardTable.style.display = 'table';

                         teamsArray.forEach((team, index) => {
                             const rank = index + 1;
                             const teamName = team.name;
                              const score = team.score !== undefined && team.score !== null ? team.score.toFixed(1) : 'N/A'; // Handle potentially missing score
                             const members = team.members || [];
                             const leadName = team.leadName || 'N/A';
                             const university = team.university || 'N/A';
                             const teamEmoji = team.emoji || '';
                             const leaderEmoji = team.leaderEmoji || '‚≠ê';

                             // Add to Leaderboard Table
                             const row = aiLeaderboardBody.insertRow();
                            row.setAttribute('data-team', teamName);
                              const membersHtml = members.map(m => {
                                  let nameHtml = m;
                                  if (m === leadName) nameHtml += ` <span class="leader-emoji">${leaderEmoji}</span>`; // Add leader emoji
                                  return nameHtml;
                              }).join(', ') || '<em class="text-muted">No members listed</em>';

                             row.innerHTML = `
                                <td class="text-center"><span class="rank-badge">${rank}</span></td>
                                 <td class="fw-bold">${teamEmoji} ${teamName}</td>
                                <td class="small">${membersHtml}</td>
                                <td class="small">${university}</td>
                                <td class="text-center score-display">${score}</td>
                             `;

                             // Highlight current user's team row
                              if (!isAdmin && teamName === currentUserData.registeredTeamName) {
                                  row.classList.add('table-info');
                                  row.style.fontWeight = 'bold';
                              }

                             // Add to Judge Dropdown
                             const option = document.createElement('option');
                             option.value = teamName;
                              option.textContent = `${teamEmoji} ${teamName} (${members.length} Member${members.length !== 1 ? 's' : ''})`;
                             judgeTeamSelect.appendChild(option);
                         });

                        if (judgeDropdownCurrentValue && judgeTeamSelect.querySelector(`option[value="${judgeDropdownCurrentValue}"]`)) {
                             judgeTeamSelect.value = judgeDropdownCurrentValue;
                         }
                     }
                } catch (error) {
                    console.error("Failed to update AI Judge modal:", error);
                     aiLeaderboardEmpty.textContent = 'Error loading team data.';
                    aiLeaderboardEmpty.style.display = 'block';
                 } finally {
                     aiLeaderboardLoading.style.display = 'none';
                     // Ensure Judge Panel visibility based on login state maybe?
                     judgeSimPanel.style.display = isLoggedIn ? 'block' : 'none';
                     judgeProjectBtn.disabled = !isLoggedIn; // Disable button if not logged in
                 }
             }

            // Functions for judge simulation (displayAnalysisSequentially, animateScoreToLeaderboard) - Unchanged Needed Here
             function displayAnalysisSequentially(analysisPoints = []) { if (!judgeResultAnalysisList) return 0; judgeResultAnalysisList.innerHTML = ''; let delay = 0; const interval = 250; analysisPoints.forEach((point) => { setTimeout(() => { const li = document.createElement('li'); li.textContent = point; judgeResultAnalysisList.appendChild(li); requestAnimationFrame(() => li.classList.add('visible')); const modalBody = judgeModalElement.querySelector('.modal-body'); if (modalBody) modalBody.scrollTop = modalBody.scrollHeight; }, delay); delay += interval; }); return delay; }
             function animateScoreToLeaderboard(teamName, score) { if (!flyingScoreElement || !judgeResultScore || !aiLeaderboardBody || !judgeModalElement) return; const targetRow = aiLeaderboardBody.querySelector(`tr[data-team="${teamName}"]`); let targetY, targetX; const modalRect = judgeModalElement.getBoundingClientRect(); if (targetRow) { const rowRect = targetRow.getBoundingClientRect(); targetY = rowRect.top + (rowRect.height / 2) - modalRect.top; const scoreCell = targetRow.querySelector('.score-display'); targetX = scoreCell ? scoreCell.getBoundingClientRect().left + (scoreCell.getBoundingClientRect().width / 2) - modalRect.left : rowRect.right - 30 - modalRect.left; } else { const tableRect = aiLeaderboardBody.getBoundingClientRect(); targetY = tableRect.top + 20 - modalRect.top; targetX = tableRect.right - 50 - modalRect.left; } const startRect = judgeResultScore.getBoundingClientRect(); const startY = startRect.top + (startRect.height / 2) - modalRect.top; const startX = startRect.left + (startRect.width / 2) - modalRect.left; flyingScoreElement.textContent = `${score.toFixed(1)}`; flyingScoreElement.style.position = 'absolute'; flyingScoreElement.style.top = `${startY}px`; flyingScoreElement.style.left = `${startX}px`; flyingScoreElement.style.opacity = '1'; flyingScoreElement.style.transform = 'scale(1)'; judgeModalElement.querySelector('.modal-dialog .modal-content .modal-body').appendChild(flyingScoreElement); requestAnimationFrame(() => { flyingScoreElement.style.top = `${targetY}px`; flyingScoreElement.style.left = `${targetX}px`; flyingScoreElement.style.opacity = '0'; flyingScoreElement.style.transform = 'scale(0.3)'; }); // Re-add the transition end listener that calls updateAiJudgeModal
                flyingScoreElement.addEventListener('transitionend', function handleTransitionEnd() {
                     flyingScoreElement.remove();
                     updateAiJudgeModal(); // Call the update function
                     flyingScoreElement.removeEventListener('transitionend', handleTransitionEnd);
                 });
             }


             // Judge button click handler
             if (judgeProjectBtn) {
                 judgeProjectBtn.addEventListener('click', async function() {
                      if (!isLoggedIn) { alert("Please log in first."); return; }

                     const selectedTeam = judgeTeamSelect.value;
                     if (!selectedTeam) { judgeResultTeamName.textContent = "Error"; judgeResultAnalysisList.innerHTML = '<li class="visible feedback-error">Please select a team first.</li>'; judgeResultScore.innerHTML = ''; judgeResultsArea.style.display='block'; return; } // Show error area

                      judgeResultsArea.style.display = 'none'; judgeLoader.style.display = 'block'; judgeProjectBtn.disabled = true; judgeTeamSelect.disabled = true;

                      try {
                          const result = await apiJudgeTeam(selectedTeam); // Simulate judging
                          judgeLoader.style.display = 'none'; judgeResultsArea.style.display = 'block';
                          judgeResultTeamName.textContent = `Evaluation: ${selectedTeam}`;
                          const displayTime = displayAnalysisSequentially(result.analysis);
                           setTimeout(() => {
                               judgeResultScore.innerHTML = `Simulated Score: <span>${result.score.toFixed(1)} / 10.0</span>`;
                               setTimeout(() => { animateScoreToLeaderboard(selectedTeam, result.score); }, 150);
                               judgeProjectBtn.disabled = false; judgeTeamSelect.disabled = false;
                           }, displayTime + 100);
                      } catch (error) {
                          console.error("Judging Simulation Error:", error);
                           judgeLoader.style.display = 'none'; judgeResultsArea.style.display = 'block';
                          judgeResultTeamName.textContent = "Error Judging"; judgeResultAnalysisList.innerHTML = `<li class="visible feedback-error">${error.message || 'Judging failed.'}</li>`; judgeResultScore.innerHTML = '';
                          judgeProjectBtn.disabled = false; judgeTeamSelect.disabled = false;
                      }
                 });

                 // Refresh teams list when judge modal opens
                 judgeModalElement.addEventListener('show.bs.modal', () => {
                      updateAiJudgeModal();
                      judgeResultsArea.style.display = 'none'; // Clear old results
                     judgeLoader.style.display = 'none';
                 });
                  judgeModalElement.addEventListener('hidden.bs.modal', () => { /* Optional: clear selection */ });
             } else { console.error("AI Judging elements not found."); }


            // --- Profile Modal & Reset Logic ---
             async function displayPointsLeaderboard() {
                if (!profileLeaderboardTableBody || !profileLeaderboardLoading || !profileLeaderboardEmpty) return;

                profileLeaderboardLoading.style.display = 'block';
                 profileLeaderboardTable.style.display = 'none';
                 profileLeaderboardTableBody.innerHTML = '';
                 profileLeaderboardEmpty.style.display = 'none';
                 profileRankDisplay.textContent = "Rank: Loading...";

                 try {
                     const leaderboard = await apiGetLeaderboard(); // Simulates fetch or gets cache

                     if (!leaderboard || leaderboard.length === 0) {
                         profileLeaderboardEmpty.textContent = 'Leaderboard is empty.';
                         profileLeaderboardEmpty.style.display = 'block';
                         profileRankDisplay.textContent = isAdmin ? "Rank: N/A (Admin)" : "Rank: N/A";
                     } else {
                          const userRankData = leaderboard.find(entry => entry.id === currentUserData.id);
                          const userRank = leaderboard.findIndex(entry => entry.id === currentUserData.id) + 1;
                          const totalPlayers = leaderboard.length;

                          if (isAdmin) {
                             profileRankDisplay.textContent = `Rank: N/A (Admin)`;
                         } else if (userRank > 0) {
                              profileRankDisplay.textContent = `Your Rank: #${userRank} of ${totalPlayers}`;
                          } else {
                              profileRankDisplay.textContent = `Rank: N/A (Not ranked yet)`;
                          }


                         const topN = 5;
                         leaderboard.slice(0, topN).forEach((entry, index) => {
                              const rank = index + 1;
                             const isCurrentUser = !isAdmin && entry.id === currentUserData.id;
                              const row = profileLeaderboardTableBody.insertRow();
                              row.innerHTML = `
                                 <td class="text-center"><span class="rank-badge">${rank}</span></td>
                                 <td>${entry.name || 'Player'} ${isCurrentUser ? '<span class="badge bg-success">You</span>' : ''}</td>
                                <td class="points-cell">${entry.points || 0}</td>
                             `;
                              if (isCurrentUser) row.classList.add('table-info');
                          });
                         profileLeaderboardTable.style.display = 'table';
                     }
                 } catch (error) {
                      console.error("Error displaying points leaderboard:", error);
                      profileRankDisplay.textContent = 'Rank: Error';
                      profileLeaderboardEmpty.textContent = 'Error loading leaderboard.';
                      profileLeaderboardEmpty.style.display = 'block';
                 } finally {
                     profileLeaderboardLoading.style.display = 'none';
                 }
             }

             // Update profile modal display on show
            if (profileModalElement) {
                 profileModalElement.addEventListener('show.bs.modal', async function () {
                     updateUserProfileDisplay(); // Ensure names/points are current
                    updateProfileTeamMembers(); // Update team list
                     if (resetFeedbackArea) resetFeedbackArea.textContent = '';
                     resetProgressBtn.disabled = isAdmin; // Disable reset for admin
                    await displayPointsLeaderboard(); // Fetch and display points leaderboard
                 });
            }

            // Reset Button Handler
             if (resetProgressBtn) {
                resetProgressBtn.addEventListener('click', async function() { // Make async
                    if (isAdmin) return; // Double check

                     if(resetFeedbackArea) resetFeedbackArea.textContent = '';

                     if (confirm("Reset ALL your Points and Tasks Progress?\nThis cannot be undone.")) {
                          resetProgressBtn.disabled = true;
                          setResetFeedback('Resetting your data...', 'info');
                          try {
                              await apiResetUserData(); // Simulate API call
                              setResetFeedback('Reset Complete!', 'success');
                              // Refresh UI immediately after successful reset
                              updateUserProfileDisplay();
                              initializeTaskUI();
                             updateProgressBar();
                              await displayPointsLeaderboard(); // Fetch leaderboard again
                              alert("Your points and tasks have been reset.");
                          } catch (error) {
                              console.error("Error during data reset:", error);
                               setResetFeedback(`Reset failed: ${error.message || 'Unknown error'}`, 'error');
                              alert(`An error occurred during reset: ${error.message || error}`);
                          } finally {
                               resetProgressBtn.disabled = false;
                          }
                     } else {
                         setResetFeedback('Reset cancelled.', 'warning');
                     }
                 });
             }
             function setResetFeedback(message, type) { if (resetFeedbackArea) { resetFeedbackArea.textContent = message; resetFeedbackArea.className = `small d-block mt-1 feedback-${type}`; } }

             // --- Initial Setup ---
             function initializeApp() {
                 // Show Login Modal on Load
                 const loginModal = new bootstrap.Modal(loginModalElement, {
                     backdrop: 'static',
                     keyboard: false
                 });
                 loginModal.show();

                 // Add Login Listeners
                loginSubmitBtn.addEventListener('click', handleLogin);
                loginPhoneInput.addEventListener('keypress', (e) => {
                     if (e.key === 'Enter') handleLogin();
                     // Show password field if admin starts typing
                     if (loginPhoneInput.value.toLowerCase().startsWith('admin')) {
                          adminPasswordGroup.style.display = 'block';
                     } else {
                          adminPasswordGroup.style.display = 'none';
                          adminPasswordInput.value = '';
                      }
                 });
                 adminPasswordInput.addEventListener('keypress', (e) => {
                      if (e.key === 'Enter') handleLogin();
                  });


                // Hide main content until login
                mainAppContent.style.display = 'none';
                 userProfileElement.style.display = 'none';
                 bottomNav.style.display = 'none';
                 floatingButtons.forEach(btn => btn.style.display = 'none');
             }

            initializeApp();

        });
    </script>

</body>
</html>
